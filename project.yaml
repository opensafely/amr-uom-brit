version: '3.0'

expectations:
  population_size: 30000

actions:
### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###
### study cohort ###

  generate_study_population_period_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1
    outputs:
      highly_sensitive:
        cohort: output/input_period_1.csv

  period_1_process:
    run: r:latest analysis/period_1_process.R
    needs: [generate_study_population_period_1]
    outputs:
      highly_sensitive: 
        csv1: output/period_1a.csv
        csv2: output/period_1_*.csv

  generate_study_population_period_1b:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1b
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1b.csv

  period_1b_quickcheck:
    run: r:latest analysis/period_1b_quickcheck.R
    needs: [generate_study_population_period_1b]
    outputs:
      moderately_sensitive: 
        csv1: output/period_1b_quickcheck.csv

  generate_study_population_period_1c:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1c
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1c.csv

  generate_study_population_period_1d:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1d
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1d.csv

  generate_study_population_period_1e:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1e
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1e.csv

  generate_study_population_period_1f:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1f
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1f.csv

  generate_study_population_period_1g:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1g
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1g.csv

  generate_study_population_period_1h:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1h
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1h.csv

  generate_study_population_period_1i:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1i
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1i.csv

  generate_study_population_period_1j:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1j
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1j.csv

  generate_study_population_period_1k:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1k
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1k.csv

  generate_study_population_period_1l:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1l
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1l.csv

  generate_study_population_period_1m:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1m
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1m.csv

  generate_study_population_period_1n:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1n
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1n.csv

  generate_study_population_period_1o:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1o
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1o.csv

  generate_study_population_period_1p:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1p
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1p.csv

  generate_study_population_period_1q:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1q
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1q.csv

  generate_study_population_period_1r:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1r
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1r.csv

  generate_study_population_period_1s:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1s
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1s.csv

  generate_study_population_period_1t:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1t
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1t.csv

  period_1a_id:
    run: r:latest analysis/period_1a_id.R
    needs: [generate_study_population_period_1]
    outputs:
      highly_sensitive: 
        csv1: output/period_1a_id.csv

  generate_study_population_period_1a:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1a
    needs: [period_1a_id]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1a.csv

  process_cox_dataset:
    run: r:latest analysis/process_cox_dataset.R
    needs: [generate_study_population_period_1a,generate_study_population_period_1b,generate_study_population_period_1c,generate_study_population_period_1d,
    generate_study_population_period_1e,generate_study_population_period_1f,generate_study_population_period_1g,generate_study_population_period_1h,
    generate_study_population_period_1i,generate_study_population_period_1j,generate_study_population_period_1k,generate_study_population_period_1l,
    generate_study_population_period_1m,generate_study_population_period_1n,generate_study_population_period_1o,generate_study_population_period_1p,
    generate_study_population_period_1q,generate_study_population_period_1r,generate_study_population_period_1s,generate_study_population_period_1t]
    outputs:
      highly_sensitive: 
        rds: output/processed_data.rds

  process_kaplan_meier_plot:
    run: r:latest analysis/prediction/kaplan_meier_plot.R
    needs: [process_cox_dataset]
    outputs:
      moderately_sensitive: 
        plot1: output/KM_overall_with_CI.jpeg
        csv1: output/surv_df.csv

  process_kaplan_meier_plot_by_infection:
    run: r:latest analysis/prediction/kaplan_meier_plot_by_infection.R
    needs: [process_cox_dataset]
    outputs:
      moderately_sensitive: 
        plot1: output/KM_by_*_with_CI.jpeg

  cox_overall:
    run: r:latest analysis/prediction/cox_overall.R
    needs: [process_cox_dataset]
    outputs:
      moderately_sensitive: 
        plot1: output/spline_age.jpeg

  process_data_for_model:
    run: r:latest analysis/prediction/process_data_for_model.R
    needs: [process_cox_dataset]
    outputs:
      highly_sensitive: 
        rds: output/data_for_cox_model.rds
      moderately_sensitive: 
        csv: output/missing_data_count.csv

  cox_uti_model:
    run: r:latest analysis/prediction/cox_uti_model.R
    needs: [process_data_for_model]
    outputs:
      moderately_sensitive: 
        csv1: output/uti_model_evaluation.csv
        plot1: output/uti_KM_Curves.jpeg
        plot2: output/uti_High_Low_Risk_Patients.jpeg
        plot3: output/uti_survival_plot_baseline_survival_curves.jpeg
        plot4: output/uti_survival_plot_baseline_survival_curves2.jpeg
        plot5: output/spline_age_uti.jpeg
        csv2: output/uti_model_HR.csv
        csv3: output/uti_model_external.csv
        plot6: output/uti_30day_calibration.jpeg
        plot7: output/uti_30day_re-calibration.jpeg

  cox_urti_model:
    run: r:latest analysis/prediction/cox_urti_model.R
    needs: [process_data_for_model]
    outputs:
      moderately_sensitive: 
        csv1: output/urti_model_evaluation.csv
        plot1: output/urti_KM_Curves.jpeg
        plot2: output/urti_High_Low_Risk_Patients.jpeg
        plot3: output/urti_survival_plot_baseline_survival_curves.jpeg
        plot4: output/urti_survival_plot_baseline_survival_curves2.jpeg
        plot5: output/spline_age_urti.jpeg
        csv2: output/urti_model_HR.csv
        csv3: output/urti_model_external.csv
        plot6: output/urti_30day_calibration.jpeg
        plot7: output/urti_30day_re-calibration.jpeg

  cox_lrti_model:
    run: r:latest analysis/prediction/cox_lrti_model.R
    needs: [process_data_for_model]
    outputs:
      moderately_sensitive: 
        csv1: output/lrti_model_evaluation.csv
        plot1: output/lrti_KM_Curves.jpeg
        plot2: output/lrti_High_Low_Risk_Patients.jpeg
        plot3: output/lrti_survival_plot_baseline_survival_curves.jpeg
        plot4: output/lrti_survival_plot_baseline_survival_curves2.jpeg
        plot5: output/spline_age_lrti.jpeg
        csv2: output/lrti_model_HR.csv
        csv3: output/lrti_model_external.csv
        plot6: output/lrti_30day_calibration.jpeg
        plot7: output/lrti_30day_re-calibration.jpeg

  cox_otexterna_model:
    run: r:latest analysis/prediction/cox_otexterna_model.R
    needs: [process_data_for_model]
    outputs:
      moderately_sensitive: 
        csv1: output/otexterna_model_evaluation.csv
        plot1: output/otexterna_KM_Curves.jpeg
        plot2: output/otexterna_High_Low_Risk_Patients.jpeg
        plot3: output/otexterna_survival_plot_baseline_survival_curves.jpeg
        plot4: output/otexterna_survival_plot_baseline_survival_curves2.jpeg
        plot5: output/spline_age_otexterna.jpeg
        csv2: output/otexterna_model_HR.csv
        csv3: output/otexterna_model_external.csv
        plot6: output/otexterna_30day_calibration.jpeg
        plot7: output/otexterna_30day_re-calibration.jpeg

  cox_otmedia_model:
    run: r:latest analysis/prediction/cox_otmedia_model.R
    needs: [process_data_for_model]
    outputs:
      moderately_sensitive: 
        csv1: output/otmedia_model_evaluation.csv
        plot1: output/otmedia_KM_Curves.jpeg
        plot2: output/otmedia_High_Low_Risk_Patients.jpeg
        plot3: output/otmedia_survival_plot_baseline_survival_curves.jpeg
        plot4: output/otmedia_survival_plot_baseline_survival_curves2.jpeg
        plot5: output/spline_age_otmedia.jpeg
        csv2: output/otmedia_model_HR.csv
        csv3: output/otmedia_model_external.csv
        plot6: output/otmedia_30day_calibration.jpeg
        plot7: output/otmedia_30day_re-calibration.jpeg

  cox_sinusitis_model:
    run: r:latest analysis/prediction/cox_sinusitis_model.R
    needs: [process_data_for_model]
    outputs:
      moderately_sensitive: 
        csv1: output/sinusitis_model_evaluation.csv
        plot1: output/sinusitis_KM_Curves.jpeg
        plot2: output/sinusitis_High_Low_Risk_Patients.jpeg
        plot3: output/sinusitis_survival_plot_baseline_survival_curves.jpeg
        plot4: output/sinusitis_survival_plot_baseline_survival_curves2.jpeg
        plot5: output/spline_age_sinusitis.jpeg
        csv2: output/sinusitis_model_HR.csv
        csv3: output/sinusitis_model_external.csv
        plot6: output/sinusitis_30day_calibration.jpeg
        plot7: output/sinusitis_30day_re-calibration.jpeg


### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###
### study cohort part 2 ###

  generate_study_population_period_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2
    outputs:
      highly_sensitive:
        cohort: output/input_period_2.csv

  period_2_process:
    run: r:latest analysis/period_2_process.R
    needs: [generate_study_population_period_2]
    outputs:
      highly_sensitive: 
        csv1: output/period_2a.csv
        csv2: output/period_2_*.csv

  period_2a_id:
    run: r:latest analysis/period_2a_id.R
    needs: [generate_study_population_period_2]
    outputs:
      highly_sensitive: 
        csv1: output/period_2a_id.csv

  generate_study_population_period_2a:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2a
    needs: [period_2a_id]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2a.csv

  generate_study_population_period_2b:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2b
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2b.csv

  generate_study_population_period_2c:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2c
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2c.csv

  generate_study_population_period_2d:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2d
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2d.csv

  generate_study_population_period_2e:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2e
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2e.csv

  generate_study_population_period_2f:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2f
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2f.csv

  generate_study_population_period_2g:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2g
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2g.csv

  generate_study_population_period_2h:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2h
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2h.csv

  generate_study_population_period_2i:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2i
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2i.csv

  generate_study_population_period_2j:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2j
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2j.csv

  generate_study_population_period_2k:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2k
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2k.csv

  generate_study_population_period_2l:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2l
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2l.csv

  generate_study_population_period_2m:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2m
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2m.csv

  generate_study_population_period_2n:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2n
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2n.csv

  generate_study_population_period_2o:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2o
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2o.csv

  generate_study_population_period_2p:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2p
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2p.csv

  generate_study_population_period_2q:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2q
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2q.csv

  generate_study_population_period_2r:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2r
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2r.csv

  generate_study_population_period_2s:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2s
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2s.csv

  generate_study_population_period_2t:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_2t
    needs: [period_2_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_2t.csv

  process_cox_dataset_2:
    run: r:latest analysis/process_cox_dataset_2.R
    needs: [generate_study_population_period_2a,generate_study_population_period_2b,generate_study_population_period_2c,generate_study_population_period_2d,
    generate_study_population_period_2e,generate_study_population_period_2f,generate_study_population_period_2g,generate_study_population_period_2h,
    generate_study_population_period_2i,generate_study_population_period_2j,generate_study_population_period_2k,generate_study_population_period_2l,
    generate_study_population_period_2m,generate_study_population_period_2n,generate_study_population_period_2o,generate_study_population_period_2p,
    generate_study_population_period_2q,generate_study_population_period_2r,generate_study_population_period_2s,generate_study_population_period_2t]
    outputs:
      highly_sensitive: 
        rds: output/processed_data_2.rds

### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###
### study cohort part 3 ###

  generate_study_population_period_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3
    outputs:
      highly_sensitive:
        cohort: output/input_period_3.csv

  period_3_process:
    run: r:latest analysis/period_3_process.R
    needs: [generate_study_population_period_3]
    outputs:
      highly_sensitive: 
        csv1: output/period_3a.csv
        csv2: output/period_3_*.csv

  period_3a_id:
    run: r:latest analysis/period_3a_id.R
    needs: [generate_study_population_period_3]
    outputs:
      highly_sensitive: 
        csv1: output/period_3a_id.csv

  generate_study_population_period_3a:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3a
    needs: [period_3a_id]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3a.csv

  generate_study_population_period_3b:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3b
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3b.csv

  generate_study_population_period_3c:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3c
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3c.csv

  generate_study_population_period_3d:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3d
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3d.csv

  generate_study_population_period_3e:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3e
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3e.csv

  generate_study_population_period_3f:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3f
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3f.csv

  generate_study_population_period_3g:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3g
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3g.csv

  generate_study_population_period_3h:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3h
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3h.csv

  generate_study_population_period_3i:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3i
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3i.csv

  generate_study_population_period_3j:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3j
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3j.csv

  generate_study_population_period_3k:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3k
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3k.csv

  generate_study_population_period_3l:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3l
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3l.csv

  generate_study_population_period_3m:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3m
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3m.csv

  generate_study_population_period_3n:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3n
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3n.csv

  generate_study_population_period_3o:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3o
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3o.csv

  generate_study_population_period_3p:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3p
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3p.csv

  generate_study_population_period_3q:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3q
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3q.csv

  generate_study_population_period_3r:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3r
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3r.csv

  generate_study_population_period_3s:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3s
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3s.csv

  generate_study_population_period_3t:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_3t
    needs: [period_3_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_3t.csv

  process_cox_dataset_3:
    run: r:latest analysis/process_cox_dataset_3.R
    needs: [generate_study_population_period_3a,generate_study_population_period_3b,generate_study_population_period_3c,generate_study_population_period_3d,
    generate_study_population_period_3e,generate_study_population_period_3f,generate_study_population_period_3g,generate_study_population_period_3h,
    generate_study_population_period_3i,generate_study_population_period_3j,generate_study_population_period_3k,generate_study_population_period_3l,
    generate_study_population_period_3m,generate_study_population_period_3n,generate_study_population_period_3o,generate_study_population_period_3p,
    generate_study_population_period_3q,generate_study_population_period_3r,generate_study_population_period_3s,generate_study_population_period_3t]
    outputs:
      highly_sensitive: 
        rds: output/processed_data_3.rds

### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###
### study cohort part 4 ###

  generate_study_population_period_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4
    outputs:
      highly_sensitive:
        cohort: output/input_period_4.csv

  period_4_process:
    run: r:latest analysis/period_4_process.R
    needs: [generate_study_population_period_4]
    outputs:
      highly_sensitive: 
        csv1: output/period_4a.csv
        csv2: output/period_4_*.csv

  period_4a_id:
    run: r:latest analysis/period_4a_id.R
    needs: [generate_study_population_period_4]
    outputs:
      highly_sensitive: 
        csv1: output/period_4a_id.csv

  generate_study_population_period_4a:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4a
    needs: [period_4a_id]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4a.csv

  generate_study_population_period_4b:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4b
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4b.csv

  generate_study_population_period_4c:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4c
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4c.csv

  generate_study_population_period_4d:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4d
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4d.csv

  generate_study_population_period_4e:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4e
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4e.csv

  generate_study_population_period_4f:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4f
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4f.csv

  generate_study_population_period_4g:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4g
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4g.csv

  generate_study_population_period_4h:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4h
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4h.csv

  generate_study_population_period_4i:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4i
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4i.csv

  generate_study_population_period_4j:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4j
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4j.csv

  generate_study_population_period_4k:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4k
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4k.csv

  generate_study_population_period_4l:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4l
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4l.csv

  generate_study_population_period_4m:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4m
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4m.csv

  generate_study_population_period_4n:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4n
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4n.csv

  generate_study_population_period_4o:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4o
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4o.csv

  generate_study_population_period_4p:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4p
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4p.csv

  generate_study_population_period_4q:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4q
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4q.csv

  generate_study_population_period_4r:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4r
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4r.csv

  generate_study_population_period_4s:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4s
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4s.csv

  generate_study_population_period_4t:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_4t
    needs: [period_4_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_4t.csv

  process_cox_dataset_4:
    run: r:latest analysis/process_cox_dataset_4.R
    needs: [generate_study_population_period_4a,generate_study_population_period_4b,generate_study_population_period_4c,generate_study_population_period_4d,
    generate_study_population_period_4e,generate_study_population_period_4f,generate_study_population_period_4g,generate_study_population_period_4h,
    generate_study_population_period_4i,generate_study_population_period_4j,generate_study_population_period_4k,generate_study_population_period_4l,
    generate_study_population_period_4m,generate_study_population_period_4n,generate_study_population_period_4o,generate_study_population_period_4p,
    generate_study_population_period_4q,generate_study_population_period_4r,generate_study_population_period_4s,generate_study_population_period_4t]
    outputs:
      highly_sensitive: 
        rds: output/processed_data_4.rds

  KM_overall:
    run: r:latest analysis/prediction2/KM_overall.R
    needs: [process_cox_dataset,process_cox_dataset_2,process_cox_dataset_3,process_cox_dataset_4]
    outputs:
      moderately_sensitive: 
        plot1: output/*_survival_plot_by_year.jpeg

  trend_by_subgroup:
    run: r:latest analysis/prediction2/trend_by_subgroup.R
    needs: [process_cox_dataset,process_cox_dataset_2,process_cox_dataset_3,process_cox_dataset_4]
    outputs:
      moderately_sensitive: 
        plot1: output/figure_rate.jpeg
        csv1: output/figure_rate_table.csv