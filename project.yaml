version: '3.0'

expectations:
  population_size: 30000

actions:
### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###
### study cohort ###

  generate_study_population_flowchart:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_flowchart
    outputs:
      highly_sensitive:
        cohort: output/input_flowchart.csv

  flowchart_count:
    run: r:latest analysis/flowchart_count.R
    needs: [generate_study_population_flowchart]
    outputs:
      moderately_sensitive: 
        csv1: output/flowchart_count.csv

### UTI ###

  generate_study_population_case_uti:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_uti
    outputs:
      highly_sensitive:
        cohort: output/input_case_uti.csv

  generate_study_population_control_uti:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_uti
    outputs:
      highly_sensitive:
        cohort: output/input_control_uti.csv

  matching_uti:
    run: python:latest python analysis/matching_uti.py
    needs: [generate_study_population_case_uti,generate_study_population_control_uti]
    outputs:
      highly_sensitive: 
        table1: output/matched_cases_uti.csv
        table2: output/matched_matches_uti.csv
        table3: output/matched_combined_uti.csv
      moderately_sensitive: 
        report1: output/matching_report_uti.txt
### UTI var ###
  generate_study_population_case_uti_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_uti_abvar
    needs: [matching_uti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_uti_abvar.csv

  generate_study_population_control_uti_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_uti_abvar
    needs: [matching_uti]
    outputs:
      highly_sensitive:
        cohort: output/input_control_uti_abvar.csv

  generate_study_population_case_uti_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_uti_othvar
    needs: [matching_uti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_uti_othvar.csv

  generate_study_population_control_uti_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_uti_othvar
    needs: [matching_uti]
    outputs:
      highly_sensitive:
        cohort: output/input_control_uti_othvar.csv

  generate_study_population_case_uti_type:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_uti_type
    needs: [matching_uti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_uti_type.csv

  generate_study_population_case_uti_type_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_uti_type_2
    needs: [matching_uti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_uti_type_2.csv


### URTI ###

  generate_study_population_case_urti:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_urti
    outputs:
      highly_sensitive:
        cohort: output/input_case_urti.csv

  generate_study_population_control_urti:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_urti
    outputs:
      highly_sensitive:
        cohort: output/input_control_urti.csv

  matching_urti:
    run: python:latest python analysis/matching_urti.py
    needs: [generate_study_population_case_urti,generate_study_population_control_urti]
    outputs:
      highly_sensitive: 
        table1: output/matched_cases_urti.csv
        table2: output/matched_matches_urti.csv
        table3: output/matched_combined_urti.csv
      moderately_sensitive: 
        report1: output/matching_report_urti.txt

### URTI var ###
  generate_study_population_case_urti_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_urti_abvar
    needs: [matching_urti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_urti_abvar.csv

  generate_study_population_control_urti_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_urti_abvar
    needs: [matching_urti]
    outputs:
      highly_sensitive:
        cohort: output/input_control_urti_abvar.csv

  generate_study_population_case_urti_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_urti_othvar
    needs: [matching_urti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_urti_othvar.csv

  generate_study_population_control_urti_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_urti_othvar
    needs: [matching_urti]
    outputs:
      highly_sensitive:
        cohort: output/input_control_urti_othvar.csv

  generate_study_population_case_urti_type:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_urti_type
    needs: [matching_urti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_urti_type.csv

### LRTI ###

  generate_study_population_case_lrti:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_lrti
    outputs:
      highly_sensitive:
        cohort: output/input_case_lrti.csv

  generate_study_population_control_lrti:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_lrti
    outputs:
      highly_sensitive:
        cohort: output/input_control_lrti.csv

  matching_lrti:
    run: python:latest python analysis/matching_lrti.py
    needs: [generate_study_population_case_lrti,generate_study_population_control_lrti]
    outputs:
      highly_sensitive: 
        table1: output/matched_cases_lrti.csv
        table2: output/matched_matches_lrti.csv
        table3: output/matched_combined_lrti.csv
      moderately_sensitive: 
        report1: output/matching_report_lrti.txt

### LRTI var ###
  generate_study_population_case_lrti_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_lrti_abvar
    needs: [matching_lrti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_lrti_abvar.csv

  generate_study_population_control_lrti_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_lrti_abvar
    needs: [matching_lrti]
    outputs:
      highly_sensitive:
        cohort: output/input_control_lrti_abvar.csv

  generate_study_population_case_lrti_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_lrti_othvar
    needs: [matching_lrti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_lrti_othvar.csv

  generate_study_population_control_lrti_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_lrti_othvar
    needs: [matching_lrti]
    outputs:
      highly_sensitive:
        cohort: output/input_control_lrti_othvar.csv

  generate_study_population_case_lrti_type:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_lrti_type
    needs: [matching_lrti]
    outputs:
      highly_sensitive:
        cohort: output/input_case_lrti_type.csv

### CDI & ABR ###

  generate_study_population_case_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_2
    outputs:
      highly_sensitive:
        cohort: output/input_case_2.csv

  generate_study_population_p_control_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2.csv

  p_control_id:
    run: r:latest analysis/p_control_id.R
    needs: [generate_study_population_p_control_2]
    outputs:
      highly_sensitive: 
        csv: output/p_control_id.csv

  generate_study_population_p_control_2_var:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_var
    needs: [p_control_id]
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_var.csv

  p_control_selection:
    run: r:latest analysis/p_control_selection.R
    needs: [generate_study_population_p_control_2_var]
    outputs:
      highly_sensitive: 
        csv: output/p_control_cohort.csv

  matching_ae2:
    run: python:latest python analysis/matching_ae2.py
    needs: [generate_study_population_case_2,p_control_selection]
    outputs:
      highly_sensitive: 
        table1: output/matched_*_ae2.csv
      moderately_sensitive: 
        report1: output/matching_report_ae2.txt

  generate_study_population_case_ae2_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_abvar
    needs: [matching_ae2]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_abvar.csv

  generate_study_population_control_ae2_abvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_abvar
    needs: [matching_ae2]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_abvar.csv

  generate_study_population_case_ae2_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_othvar
    needs: [matching_ae2]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_othvar.csv

  generate_study_population_control_ae2_othvar:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_othvar
    needs: [matching_ae2]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_othvar.csv

  case2_abvar_process:
    run: r:latest analysis/casecontrol2/case2_abvar_process.R
    needs: [generate_study_population_case_ae2_abvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_abvar.rds

  case2_othvar_process:
    run: r:latest analysis/casecontrol2/case2_othvar_process.R
    needs: [generate_study_population_case_ae2_othvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_othvar.rds

  control2_abvar_process:
    run: r:latest analysis/casecontrol2/control2_abvar_process.R
    needs: [generate_study_population_control_ae2_abvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_abvar.rds

  control2_othvar_process:
    run: r:latest analysis/casecontrol2/control2_othvar_process.R
    needs: [generate_study_population_control_ae2_othvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_othvar.rds

  model2_process_2:
    run: r:latest analysis/casecontrol2/model2_process_2.R
    needs: [matching_ae2,case2_abvar_process,control2_abvar_process]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model2_ae2.rds

  model2_process:
    run: r:latest analysis/casecontrol2/model2_process.R
    needs: [matching_ae2,case2_abvar_process,case2_othvar_process,control2_abvar_process,control2_othvar_process]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model_ae2.rds

  model2_table:
    run: r:latest analysis/casecontrol2/model2_table.R
    needs: [model2_process]
    outputs:
      moderately_sensitive: 
        csv1: output/table_2_*_case.csv
        csv2: output/table_2_*_control.csv

  type_process_2:
    run: r:latest analysis/casecontrol2/type_process_2.R
    needs: [matching_ae2,case2_abvar_process,control2_abvar_process]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model2_ae2_cdi.rds

  type_process_3:
    run: r:latest analysis/casecontrol2/type_process_3.R
    needs: [matching_ae2,case2_abvar_process,control2_abvar_process]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model2_ae2_abr.rds

  CDIABR_OR:
    run: r:latest analysis/casecontrol2/CDIABR_OR.R
    needs: [model2_process_2]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_model_result.csv

  CDIABR_OR_abtype:
    run: r:latest analysis/casecontrol2/CDIABR_OR_abtype.R
    needs: [model2_process]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_model_result_abtype.csv
        csv2: output/ae2_ab_history_table_icd10.csv

  CDI_OR:
    run: r:latest analysis/casecontrol2/CDI_OR.R
    needs: [type_process_2]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_cdi_model_result.csv

  ABR_OR:
    run: r:latest analysis/casecontrol2/ABR_OR.R
    needs: [type_process_3]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_abr_model_result.csv


### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###

  case_othvar_process:
    run: r:latest analysis/casecontrol/case_othvar_process.R
    needs: [generate_study_population_case_uti_othvar,generate_study_population_case_urti_othvar,
    generate_study_population_case_lrti_othvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_*_othvar.rds

  control_othvar_process:
    run: r:latest analysis/casecontrol/control_othvar_process.R
    needs: [generate_study_population_control_uti_othvar,generate_study_population_control_urti_othvar,
    generate_study_population_control_lrti_othvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_*_othvar.rds

  case_abvar_process:
    run: r:latest analysis/casecontrol/case_abvar_process.R
    needs: [generate_study_population_case_uti_abvar,generate_study_population_case_urti_abvar,
    generate_study_population_case_lrti_abvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_*_abvar.rds

  control_abvar_process:
    run: r:latest analysis/casecontrol/control_abvar_process.R
    needs: [generate_study_population_control_uti_abvar,generate_study_population_control_urti_abvar,
    generate_study_population_control_lrti_abvar]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_*_abvar.rds

  model_process:
    run: r:latest analysis/casecontrol/model_process.R
    needs: [matching_uti,matching_urti,matching_lrti,case_othvar_process,control_othvar_process,case_abvar_process,control_abvar_process]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model_*.rds

  model_OR:
    run: r:latest analysis/casecontrol/model_OR.R
    needs: [model_process]
    outputs:
      moderately_sensitive: 
        csv: output/*_model_result.csv

  model_abhistory_OR:
    run: r:latest analysis/casecontrol/model_abhistory_OR.R
    needs: [model_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_abhistory_model_result.csv
        csv2: output/*_ab_history_freq.csv

  model_table:
    run: r:latest analysis/casecontrol/model_table.R
    needs: [model_process]
    outputs:
      moderately_sensitive: 
        csv1: output/table_1_*_case.csv
        csv2: output/table_1_*_control.csv

  case_type_process:
    run: r:latest analysis/casecontrol/case_type_process.R
    needs: [generate_study_population_case_uti_type,generate_study_population_case_urti_type,
    generate_study_population_case_lrti_type,matching_uti,matching_urti,matching_lrti]
    outputs:
      highly_sensitive: 
        csv: output/mapping_*.csv

  model_abhistory_OR_renal:
    run: r:latest analysis/casecontrol/model_abhistory_OR_renal.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_abhistory_model_result_renal.csv
        csv2: output/*_ab_history_freq_renal.csv

  model_abhistory_OR_disease:
    run: r:latest analysis/casecontrol/model_abhistory_OR_disease.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_abhistory_model_result_disease.csv
        csv2: output/*_ab_history_freq_disease.csv

  model_abhistory_OR_sideeffect:
    run: r:latest analysis/casecontrol/model_abhistory_OR_sideeffect.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_abhistory_model_result_sideeffect.csv
        csv2: output/*_ab_history_freq_sideeffect.csv

  model_table_sideeffect:
    run: r:latest analysis/casecontrol/model_table_sideeffect.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/table_1_*_case_sideeffect.csv
        csv2: output/table_1_*_control_sideeffect.csv

  model_table_disease:
    run: r:latest analysis/casecontrol/model_table_disease.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/table_1_*_case_disease.csv
        csv2: output/table_1_*_control_disease.csv

  table_typecheck:
    run: r:latest analysis/casecontrol/table_typecheck.R
    needs: [generate_study_population_case_uti_type,generate_study_population_case_urti_type,generate_study_population_case_lrti_type]
    outputs:
      moderately_sensitive: 
        csv1: output/table_case_*_type.csv

  model_OR_sideeffect:
    run: r:latest analysis/casecontrol/model_OR_sideeffect.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_model_result_sideeffect.csv
        csv2: output/*_freq_sideeffect.csv

  model_OR_disease:
    run: r:latest analysis/casecontrol/model_OR_disease.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_model_result_disease.csv
        csv2: output/*_freq_disease.csv


  model_OR_renal:
    run: r:latest analysis/casecontrol/model_OR_renal.R
    needs: [model_process,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/*_model_result_renal.csv
        csv2: output/*_freq_renal.csv

  case_abvar_freq_process:
    run: r:latest analysis/casecontrol/case_abvar_freq_process.R
    needs: [generate_study_population_case_uti_abvar,generate_study_population_case_urti_abvar,
    generate_study_population_case_lrti_abvar]
    outputs:
      moderately_sensitive: 
        csv: output/processed/input_case_*_abvar_freq_ab.csv
      highly_sensitive: 
        rds: output/processed/input_case_*_ab.rds

  control_abvar_freq_process:
    run: r:latest analysis/casecontrol/control_abvar_freq_process.R
    needs: [generate_study_population_control_uti_abvar,generate_study_population_control_urti_abvar,
    generate_study_population_control_lrti_abvar]
    outputs:
      moderately_sensitive: 
        csv: output/processed/input_control_*_abvar_freq_ab.csv
      highly_sensitive: 
        rds: output/processed/input_control_*_ab.rds

  model_process_ab:
    run: r:latest analysis/casecontrol/model_process_ab.R
    needs: [matching_uti,matching_urti,matching_lrti,case_othvar_process,control_othvar_process,
    case_abvar_process,control_abvar_process]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model_*_ab.rds

  ab_freq_table:
    run: r:latest analysis/casecontrol/ab_freq_table.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/case_*_medication_freq_table.csv

  ab_freq_table_control:
    run: r:latest analysis/casecontrol/ab_freq_table_control.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/control_*_medication_freq_table.csv

  type_uti_OR:
    run: r:latest analysis/casecontrol/type_uti_OR.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/uti_*_OR.csv
        csv2: output/uti_ab_medication_freq.csv

  type_urti_OR:
    run: r:latest analysis/casecontrol/type_urti_OR.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/urti_*_OR.csv
        csv2: output/urti_ab_medication_freq.csv

  type_lrti_OR:
    run: r:latest analysis/casecontrol/type_lrti_OR.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/lrti_*_OR.csv
        csv2: output/lrti_ab_medication_freq.csv

  type_uti_OR_reorder:
    run: r:latest analysis/casecontrol/type_uti_OR_reorder.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/uti_ab_type_OR_reorder.csv

  type_urti_OR_reorder:
    run: r:latest analysis/casecontrol/type_urti_OR_reorder.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/urti_ab_type_OR_reorder.csv

  type_lrti_OR_reorder:
    run: r:latest analysis/casecontrol/type_lrti_OR_reorder.R
    needs: [model_process_ab]
    outputs:
      moderately_sensitive: 
        csv1: output/lrti_ab_type_OR_reorder.csv

  type_uti_OR_renal:
    run: r:latest analysis/casecontrol/type_uti_OR_renal.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/uti_*_OR_renal.csv
        csv2: output/uti_ab_medication_freq_renal.csv

  type_urti_OR_renal:
    run: r:latest analysis/casecontrol/type_urti_OR_renal.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/urti_*_OR_renal.csv
        csv2: output/urti_ab_medication_freq_renal.csv

  type_lrti_OR_renal:
    run: r:latest analysis/casecontrol/type_lrti_OR_renal.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/lrti_*_OR_renal.csv
        csv2: output/lrti_ab_medication_freq_renal.csv

  type_uti_OR_disease:
    run: r:latest analysis/casecontrol/type_uti_OR_disease.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/uti_*_OR_disease.csv
        csv2: output/uti_ab_medication_freq_disease.csv

  type_uti_OR_sideeffect:
    run: r:latest analysis/casecontrol/type_uti_OR_sideeffect.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/uti_*_OR_sideeffect.csv
        csv2: output/uti_ab_medication_freq_sideeffect.csv

  type_urti_OR_disease:
    run: r:latest analysis/casecontrol/type_urti_OR_disease.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/urti_*_OR_disease.csv
        csv2: output/urti_ab_medication_freq_disease.csv

  type_urti_OR_sideeffect:
    run: r:latest analysis/casecontrol/type_urti_OR_sideeffect.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/urti_*_OR_sideeffect.csv
        csv2: output/urti_ab_medication_freq_sideeffect.csv

  type_lrti_OR_disease:
    run: r:latest analysis/casecontrol/type_lrti_OR_disease.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/lrti_*_OR_disease.csv
        csv2: output/lrti_ab_medication_freq_disease.csv

  type_lrti_OR_sideeffect:
    run: r:latest analysis/casecontrol/type_lrti_OR_sideeffect.R
    needs: [model_process_ab,case_type_process]
    outputs:
      moderately_sensitive: 
        csv1: output/lrti_*_OR_sideeffect.csv
        csv2: output/lrti_ab_medication_freq_sideeffect.csv


##########################################################################

  generate_study_population_case_2_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_2_amr
    outputs:
      highly_sensitive:
        cohort: output/input_case_2_amr.csv

  generate_study_population_p_control_2_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_amr
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_amr.csv

  p_control_id_amr:
    run: r:latest analysis/p_control_id_amr.R
    needs: [generate_study_population_p_control_2_amr]
    outputs:
      highly_sensitive: 
        csv: output/p_control_id_amr.csv

  generate_study_population_p_control_2_var_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_var_amr
    needs: [p_control_id_amr]
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_var_amr.csv

  p_control_selection_amr:
    run: r:latest analysis/p_control_selection_amr.R
    needs: [generate_study_population_p_control_2_var_amr]
    outputs:
      highly_sensitive: 
        csv: output/p_control_cohort_amr.csv

  matching_ae2_amr:
    run: python:latest python analysis/matching_ae2_amr.py
    needs: [generate_study_population_case_2_amr,p_control_selection_amr]
    outputs:
      highly_sensitive: 
        table1: output/matched_*_ae2_amr.csv
      moderately_sensitive: 
        report1: output/matching_report_ae2_amr.txt

  generate_study_population_case_ae2_abvar_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_abvar_amr
    needs: [matching_ae2_amr]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_abvar_amr.csv

  generate_study_population_control_ae2_abvar_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_abvar_amr
    needs: [matching_ae2_amr]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_abvar_amr.csv

  generate_study_population_case_ae2_othvar_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_othvar_amr
    needs: [matching_ae2_amr]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_othvar_amr.csv

  generate_study_population_control_ae2_othvar_amr:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_othvar_amr
    needs: [matching_ae2_amr]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_othvar_amr.csv

  case2_abvar_process_amr:
    run: r:latest analysis/casecontrol2_amr/case2_abvar_process_amr.R
    needs: [generate_study_population_case_ae2_abvar_amr]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_abvar_amr.rds

  case2_othvar_process_amr:
    run: r:latest analysis/casecontrol2_amr/case2_othvar_process_amr.R
    needs: [generate_study_population_case_ae2_othvar_amr]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_othvar_amr.rds

  control2_abvar_process_amr:
    run: r:latest analysis/casecontrol2_amr/control2_abvar_process_amr.R
    needs: [generate_study_population_control_ae2_abvar_amr]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_abvar_amr.rds

  control2_othvar_process_amr:
    run: r:latest analysis/casecontrol2_amr/control2_othvar_process_amr.R
    needs: [generate_study_population_control_ae2_othvar_amr]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_othvar_amr.rds

  model2_process_amr:
    run: r:latest analysis/casecontrol2_amr/model2_process_amr.R
    needs: [matching_ae2_amr,case2_abvar_process_amr,case2_othvar_process_amr,control2_abvar_process_amr,control2_othvar_process_amr]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model_ae2_amr.rds

  CDIABR_OR_abtype_amr:
    run: r:latest analysis/casecontrol2_amr/CDIABR_OR_abtype_amr.R
    needs: [model2_process_amr]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_model_result_abtype_amr.csv
        csv2: output/ae2_ab_history_table.csv

  model2_table_amr:
    run: r:latest analysis/casecontrol2_amr/model2_table_amr.R
    needs: [model2_process_amr]
    outputs:
      moderately_sensitive: 
        csv1: output/table_2_*_case_amr.csv
        csv2: output/table_2_*_control_amr.csv

##########################################################################


  generate_study_population_case_2_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_2_cdi
    outputs:
      highly_sensitive:
        cohort: output/input_case_2_cdi.csv

  generate_study_population_p_control_2_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_cdi
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_cdi.csv

  p_control_id_cdi:
    run: r:latest analysis/p_control_id_cdi.R
    needs: [generate_study_population_p_control_2_cdi]
    outputs:
      highly_sensitive: 
        csv: output/p_control_id_cdi.csv

  generate_study_population_p_control_2_var_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_var_cdi
    needs: [p_control_id_cdi]
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_var_cdi.csv

  p_control_selection_cdi:
    run: r:latest analysis/p_control_selection_cdi.R
    needs: [generate_study_population_p_control_2_var_cdi]
    outputs:
      highly_sensitive: 
        csv: output/p_control_cohort_cdi.csv

  matching_ae2_cdi:
    run: python:latest python analysis/matching_ae2_cdi.py
    needs: [generate_study_population_case_2_cdi,p_control_selection_cdi]
    outputs:
      highly_sensitive: 
        table1: output/matched_*_ae2_cdi.csv
      moderately_sensitive: 
        report1: output/matching_report_ae2_cdi.txt

  generate_study_population_case_ae2_abvar_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_abvar_cdi
    needs: [matching_ae2_cdi]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_abvar_cdi.csv

  generate_study_population_control_ae2_abvar_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_abvar_cdi
    needs: [matching_ae2_cdi]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_abvar_cdi.csv

  generate_study_population_case_ae2_othvar_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_othvar_cdi
    needs: [matching_ae2_cdi]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_othvar_cdi.csv

  generate_study_population_control_ae2_othvar_cdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_othvar_cdi
    needs: [matching_ae2_cdi]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_othvar_cdi.csv

  case2_abvar_process_cdi:
    run: r:latest analysis/casecontrol2_cdi/case2_abvar_process_cdi.R
    needs: [generate_study_population_case_ae2_abvar_cdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_abvar_cdi.rds

  case2_othvar_process_cdi:
    run: r:latest analysis/casecontrol2_cdi/case2_othvar_process_cdi.R
    needs: [generate_study_population_case_ae2_othvar_cdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_othvar_cdi.rds

  control2_abvar_process_cdi:
    run: r:latest analysis/casecontrol2_cdi/control2_abvar_process_cdi.R
    needs: [generate_study_population_control_ae2_abvar_cdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_abvar_cdi.rds

  control2_othvar_process_cdi:
    run: r:latest analysis/casecontrol2_cdi/control2_othvar_process_cdi.R
    needs: [generate_study_population_control_ae2_othvar_cdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_othvar_cdi.rds

  model2_process_cdi:
    run: r:latest analysis/casecontrol2_cdi/model2_process_cdi.R
    needs: [matching_ae2_cdi,case2_abvar_process_cdi,case2_othvar_process_cdi,control2_abvar_process_cdi,control2_othvar_process_cdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model_ae2_cdi.rds

  CDIABR_OR_abtype_cdi:
    run: r:latest analysis/casecontrol2_cdi/CDIABR_OR_abtype_cdi.R
    needs: [model2_process_cdi]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_model_result_abtype_cdi.csv
        csv2: output/ae2_ab_history_table_cdi.csv

  model2_table_cdi:
    run: r:latest analysis/casecontrol2_cdi/model2_table_cdi.R
    needs: [model2_process_cdi]
    outputs:
      moderately_sensitive: 
        csv1: output/table_2_*_case_cdi.csv
        csv2: output/table_2_*_control_cdi.csv

##########################################################################
  generate_study_population_case_2_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_2_amrcdi
    outputs:
      highly_sensitive:
        cohort: output/input_case_2_amrcdi.csv

  generate_study_population_p_control_2_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_amrcdi
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_amrcdi.csv

  p_control_id_amrcdi:
    run: r:latest analysis/p_control_id_amrcdi.R
    needs: [generate_study_population_p_control_2_amrcdi]
    outputs:
      highly_sensitive: 
        csv: output/p_control_id_amrcdi.csv

  generate_study_population_p_control_2_var_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_p_control_2_var_amrcdi
    needs: [p_control_id_amrcdi]
    outputs:
      highly_sensitive:
        cohort: output/input_p_control_2_var_amrcdi.csv

  p_control_selection_amrcdi:
    run: r:latest analysis/p_control_selection_amrcdi.R
    needs: [generate_study_population_p_control_2_var_amrcdi]
    outputs:
      highly_sensitive: 
        csv: output/p_control_cohort_amrcdi.csv

  matching_ae2_amrcdi:
    run: python:latest python analysis/matching_ae2_amrcdi.py
    needs: [generate_study_population_case_2_amrcdi,p_control_selection_amrcdi]
    outputs:
      highly_sensitive: 
        table1: output/matched_*_ae2_amrcdi.csv
      moderately_sensitive: 
        report1: output/matching_report_ae2_amrcdi.txt

  generate_study_population_case_ae2_abvar_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_abvar_amrcdi
    needs: [matching_ae2_amrcdi]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_abvar_amrcdi.csv

  generate_study_population_control_ae2_abvar_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_abvar_amrcdi
    needs: [matching_ae2_amrcdi]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_abvar_amrcdi.csv

  generate_study_population_case_ae2_othvar_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_case_ae2_othvar_amrcdi
    needs: [matching_ae2_amrcdi]
    outputs:
      highly_sensitive:
        cohort: output/input_case_ae2_othvar_amrcdi.csv

  generate_study_population_control_ae2_othvar_amrcdi:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_control_ae2_othvar_amrcdi
    needs: [matching_ae2_amrcdi]
    outputs:
      highly_sensitive:
        cohort: output/input_control_ae2_othvar_amrcdi.csv

  case2_abvar_process_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/case2_abvar_process_amrcdi.R
    needs: [generate_study_population_case_ae2_abvar_amrcdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_abvar_amrcdi.rds

  case2_othvar_process_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/case2_othvar_process_amrcdi.R
    needs: [generate_study_population_case_ae2_othvar_amrcdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_case_ae2_othvar_amrcdi.rds

  control2_abvar_process_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/control2_abvar_process_amrcdi.R
    needs: [generate_study_population_control_ae2_abvar_amrcdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_abvar_amrcdi.rds

  control2_othvar_process_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/control2_othvar_process_amrcdi.R
    needs: [generate_study_population_control_ae2_othvar_amrcdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/input_control_ae2_othvar_amrcdi.rds

  model2_process_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/model2_process_amrcdi.R
    needs: [matching_ae2_amrcdi,case2_abvar_process_amrcdi,case2_othvar_process_amrcdi,control2_abvar_process_amrcdi,control2_othvar_process_amrcdi]
    outputs:
      highly_sensitive: 
        rds1: output/processed/model_ae2_amrcdi.rds

  CDIABR_OR_abtype_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/CDIABR_OR_abtype_amrcdi.R
    needs: [model2_process_amrcdi]
    outputs:
      moderately_sensitive: 
        csv1: output/ae2_model_result_abtype_amrcdi.csv
        csv2: output/ae2_ab_history_table_amrcdi.csv

  model2_table_amrcdi:
    run: r:latest analysis/casecontrol2_amrcdi/model2_table_amrcdi.R
    needs: [model2_process_amrcdi]
    outputs:
      moderately_sensitive: 
        csv1: output/table_2_*_case_amrcdi.csv
        csv2: output/table_2_*_control_amrcdi.csv