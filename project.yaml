version: '3.0'

expectations:
  population_size: 1000

actions:

  generate_study_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition --index-date-range "2019-01-01 to today by month" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_*.csv.gz

  generate_study_population_broad_comparison:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_broad_comparison --index-date-range "2019-01-01 to today by month" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_broad_*.csv.gz
  
  generate_study_population_covidcheck:
      run: cohortextractor:latest generate_cohort --study-definition study_definition_covidcheck_2 
        --output-format=csv.gz
      outputs:
        highly_sensitive:
          cohort: output/input_covidcheck_2.csv.gz

  generate_study_population_samedayab:
      run: cohortextractor:latest generate_cohort --study-definition study_definition_sameday_ab 
        --output-format=csv.gz
      outputs:
        highly_sensitive:
          cohort: output/input_sameday_ab.csv.gz

  generate_study_population_withab:
      run: cohortextractor:latest generate_cohort --study-definition study_definition_withab_cohort 
        --output-format=csv.gz
      outputs:
        highly_sensitive:
          cohort: output/input_withab_cohort.csv.gz

  generate_study_population_infection:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_infection --index-date-range "2019-01-01 to today by month" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_infection_*.csv.gz

  generate_study_population_elderly:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_elderly 
      --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/input_elderly.csv.gz

  generate_measures:
    run: cohortextractor:latest generate_measures --study-definition study_definition --skip-existing --output-dir=output/measures
    needs: [generate_study_population]
    outputs:
      moderately_sensitive:
        measure_csv: output/measures/measure_*.csv
  
  generate_measures_infection:
    run: cohortextractor:latest generate_measures --study-definition study_definition_infection --skip-existing --output-dir=output/measures
    needs: [generate_study_population_infection]
    outputs:
      moderately_sensitive:
        measure_csv: output/measures/measure_infection_*.csv

  generate_measures_broad:
    run: cohortextractor:latest generate_measures --study-definition study_definition_broad_comparison --skip-existing --output-dir=output/measures
    needs: [generate_study_population_broad_comparison]
    outputs:
      moderately_sensitive:
        measure_csv: output/measures/measure_broad_*.csv

## for appropriateness of antibiotic prescribing 
  # generate_study_population_repeat_antibiotics: 
  #   run: cohortextractor:latest generate_cohort --study-definition study_definition_ab_repeat --index-date-range "2019-01-01 to today by month" --skip-existing --output-dir=output/measures --output-format=csv.gz
  #   outputs:
  #     highly_sensitive:
  #       cohort: output/measures/input_ab_repeat_*.csv.gz

  # describe_repeat_ab_process:
  #   run: r:latest analysis/process/ab_repeat_transform.R
  #   needs: [generate_study_population_repeat_antibiotics]
  #   outputs:
  #      moderately_sensitive:
  #       rds1: output/measures/repeatab_uti.rds
  #       rds2: output/measures/repeatab_lrti.rds
  #       rds3: output/measures/repeatab_urti.rds


        
  # describe_elderly_agedis:
  #   run: r:latest analysis/tables/gen_csv_age_check.R
  #   needs: [generate_study_population_elderly]
  #   outputs:
  #     moderately_sensitive:
  #       agetable: output/age_quant.csv

  # describe:
  #   run: r:latest analysis/plot/overall_ab_prescribing.R
  #   needs: [generate_measures]
  #   outputs:
  #     moderately_sensitive:
  #       cohort: output/overall.png
  #       boxplot: output/overallbox.png

  describe_percentile:
    run: r:latest analysis/plot/overall_ab_prescribing_2575percentile.R
    needs: [generate_measures]
    outputs:
      moderately_sensitive:
        percentile: output/overall_25th_75th_percentile.jpeg
        table_total: output/total_number_antibacterial_prescriptions.csv

  describe_percentile_starpu:
    run: r:latest analysis/plot/starpu_ab_percentile.R
    needs: [generate_measures]
    outputs:
      moderately_sensitive:
        percentile_STARPU: output/overall_25th_75th_percentile_STARPU.jpeg
        percentile_csv_STARPU: output/monthly_quantile_ab_STARPU.csv
  
  # generate_notebook_starpu:
  #   run: jupyter:latest jupyter nbconvert /workspace/analysis/starpu.ipynb --execute --to html --output-dir=/workspace/output --ExecutePreprocessor.timeout=86400
  #   needs: [generate_measures]
  #   outputs:
  #     moderately_sensitive:
  #       notebook: output/starpu.html 
  #       figures: output/*
  #       #tables: output/tables/*
  #       #csvs: output/*/* # two possible subfolders
  #       #text: output/text/*
  
  describe_service_eval_baseline_table:
    run: r:latest analysis/tables/baseline_table.R
    needs: [generate_study_population]
    outputs:
      moderately_sensitive:
        baseline_overall: output/overall_counts_blt.csv
        baseline_table: output/blt_one_random_obs_perpat.csv

  describe_baseline_table_split_2019:
    run: r:latest analysis/tables/baseline_table_2019.R
    needs: [describe_basic_record_process]
    outputs:
      moderately_sensitive:
        baseline_overall_2019: output/overall_counts_blt_2019.csv
        baseline_table_2019: output/blt_one_random_obs_perpat_2019.csv

  describe_baseline_table_split_2020:
    run: r:latest analysis/tables/baseline_table_2020.R
    needs: [describe_basic_record_process]
    outputs:
      moderately_sensitive:
        baseline_overall_2020: output/overall_counts_blt_2020.csv
        baseline_table_2020: output/blt_one_random_obs_perpat_2020.csv

  describe_baseline_table_split_2021:
    run: r:latest analysis/tables/baseline_table_2021.R
    needs: [describe_basic_record_process]
    outputs:
      moderately_sensitive:
        baseline_overall_2021: output/overall_counts_blt_2021.csv
        baseline_table_2021: output/blt_one_random_obs_perpat_2021.csv
    
  describe_baseline_table_split_2022:
    run: r:latest analysis/tables/baseline_table_2022.R
    needs: [describe_basic_record_process]
    outputs:
      moderately_sensitive:
        baseline_overall_2022: output/overall_counts_blt_2022.csv
        baseline_table_2022: output/blt_one_random_obs_perpat_2022.csv

  describe_service_eval_covid_check:
    run: r:latest analysis/tables/baseline_table_covid_check.R
    needs: [generate_study_population_covidcheck]
    outputs:
      moderately_sensitive:
        baseline_covidcheck: output/overall_covid.csv
        blt_covidcheck: output/blt_covid_check.csv

  # describe_consultation_rate:
  #   run: r:latest analysis/plot/incident_consultation_age_stacked_barchart.R
  #   needs: [generate_measures]
  #   outputs:
  #      moderately_sensitive:
  #       bar1: output/consult_age_UTI.png
  #       bar2: output/consult_age_LRTI.png
  #       bar3: output/consult_age_URTI.png
  #       bar4: output/consult_age_sinusitis.png
  #       bar5: output/consult_age_ot_externa.png
  #       bar6: output/consult_age_otmedia.png
  #       bar7: output/consult_age_repeatedUTI.png
       


  # describe_consultation_prescribed:
  #   run: r:latest analysis/plot/consultation_prescibed_percentage.R
  #   needs: [generate_study_population]
  #   outputs:
  #      moderately_sensitive:
  #       bar1: output/prescribed_percentage_UTI.png
  #       csvs: output/uti_prescrib_check.csv
     

  #generate_notebook_starpu:
  #  run: jupyter:latest jupyter nbconvert /workspace/analysis/starpu.ipynb --execute --to html --output-dir=/workspace/output/hospitalisation_risk --ExecutePreprocessor.timeout=86400
  #  needs: [generate_measures]
  #  outputs:
  #    moderately_sensitive:
  #      notebook: output/hospitalisation_risk/starpu.html 
  #      figures: output/hospitalisation_risk/*
        #tables: output/tables/*
        #csvs: output/*/* # two possible subfolders
        #text: output/text/*

  # generate_notebook_hospitalisation_analysis:
  #   run: jupyter:latest jupyter nbconvert /workspace/analysis/hospitalisation_analysis.ipynb --execute --to html --output-dir=/workspace/output/hospitalisation_risk --ExecutePreprocessor.timeout=86400
  #   needs: [generate_study_population]
  #   outputs:
  #   moderately_sensitive:
  #       notebook: output/hospitalisation_risk/hospitalisation_analysis.html 
  #       figures: output/hospitalisation_risk/*
    
  # generate_notebook_hospitalisation_analysis:
  #   run: jupyter:latest jupyter nbconvert /workspace/analysis/hospitalisation_analysis.ipynb --execute --to html --output-dir=/workspace/output/hospitalisation_risk --ExecutePreprocessor.timeout=86400
  #   needs: [generate_study_population]
  #   outputs:
  #     moderately_sensitive:
  #       notebook: output/hospitalisation_risk/hospitalisation_analysis.html 
  #       figures: output/hospitalisation_risk/*

  describe_prior_ab_12mb4:
    run: r:latest analysis/plot/ab_1yb4_stackedbar_2.R
    needs: [generate_study_population]
    outputs:
       moderately_sensitive:
        plot: output/AB_1yb4_line.jpeg
        plot_sex: output/AB_1yb4_SEX.jpeg
        #count_table: output/prior_ab_by_month.csv      


  describe_consultation_rate_all_incident:
    run: r:latest analysis/plot/consultation_by_age_infection_incident.R
    needs: [generate_measures_infection]
    outputs:
       moderately_sensitive:
        plot1.1: output/consult_age_incident_UTI.jpeg
        plot1.2: output/consult_age_incident_URTI.jpeg
        plot1.3: output/consult_age_incident_LRTI.jpeg
        plot1.4: output/consult_age_incident_sinusitis.jpeg
        plot1.5: output/consult_age_incident_otmedia.jpeg
        plot1.6: output/consult_age_incident_ot_externa.jpeg
        plot2: output/consult_all_incident.jpeg
        csv1: output/consultation_rate_incident.csv
        csv2: output/consultation_GP_rate_incident.csv
  
  describe_consultation_rate_all_prevalent:
    run: r:latest analysis/plot/consultation_by_age_infection_prevalent.R
    needs: [generate_measures_infection]
    outputs:
       moderately_sensitive:
        plot1.1: output/consult_age_prevalent_UTI.jpeg
        plot1.2: output/consult_age_prevalent_URTI.jpeg
        plot1.3: output/consult_age_prevalent_LRTI.jpeg
        plot1.4: output/consult_age_prevalent_sinusitis.jpeg
        plot1.5: output/consult_age_prevalent_otmedia.jpeg
        plot1.6: output/consult_age_prevalent_ot_externa.jpeg
        plot2: output/consult_all_prevalent.jpeg
        csv1: output/consultation_rate_prevalent.csv
        csv2: output/consultation_GP_rate_prevalent.csv
  
  describe_consultation_rate_all_incident_redacted:
    run: r:latest analysis/redaction/consultation_by_age_infection_incident.R
    needs: [generate_measures_infection]
    outputs:
       moderately_sensitive:
        plot1.1: output/redacted/consult_age_incident_UTI.jpeg
        plot1.2: output/redacted/consult_age_incident_URTI.jpeg
        plot1.3: output/redacted/consult_age_incident_LRTI.jpeg
        plot1.4: output/redacted/consult_age_incident_sinusitis.jpeg
        plot1.5: output/redacted/consult_age_incident_otmedia.jpeg
        plot1.6: output/redacted/consult_age_incident_ot_externa.jpeg
        csv1: output/redacted/consultation_rate_incident_check.csv
        csv2: output/redacted/consultation_rate_incident.csv

  describe_consultation_rate_all_prevalent_redacted:
    run: r:latest analysis/redaction/consultation_by_age_infection_prevalent.R
    needs: [generate_measures_infection]
    outputs:
       moderately_sensitive: 
        plot1.1: output/redacted/consult_age_prevalent_UTI.jpeg
        plot1.2: output/redacted/consult_age_prevalent_URTI.jpeg
        plot1.3: output/redacted/consult_age_prevalent_LRTI.jpeg
        plot1.4: output/redacted/consult_age_prevalent_sinusitis.jpeg
        plot1.5: output/redacted/consult_age_prevalent_otmedia.jpeg
        plot1.6: output/redacted/consult_age_prevalent_ot_externa.jpeg
        csv1: output/redacted/consultation_rate_prevalent_check.csv
        csv2: output/redacted/consultation_rate_prevalent.csv

  describe_consultation_rate_all_GP_redacted:
    run: r:latest analysis/redaction/consultation_by_age_infection_GP.R
    needs: [generate_measures_infection]
    outputs:
       moderately_sensitive: 
        plot1: output/redacted/consult_all_prevalent.jpeg
        plot2: output/redacted/consult_all_incident.jpeg
        plot3: output/redacted/consult_all.jpeg
        csv1: output/redacted/consultation_rate_GP_check.csv
        csv1.2: output/redacted/consultation_all_GP_check.csv
        csv2: output/redacted/consultation_GP_rate_prevalent.csv
        csv3: output/redacted/consultation_GP_rate_incident.csv

  describe_consultation_model_process_1:
    run: r:latest analysis/process/consultation_variables_1.R
    needs: [generate_measures_infection, describe_basic_record_process]
    outputs:
       moderately_sensitive:
        rds1: output/measures/consult_UTI.rds
        rds2: output/measures/consult_LRTI.rds
        rds3: output/measures/consult_URTI.rds
        rds4: output/measures/consult_sinusitis.rds
        rds5: output/measures/consult_otmedia.rds
        rds6: output/measures/consult_ot_externa.rds

  describe_consultation_model_process_2:
    run: r:latest analysis/process/consultation_variables_2.R
    needs: [describe_consultation_model_process_1]
    outputs:
       moderately_sensitive:
        rds1: output/measures/monthly_consult_UTI.rds
        rds2: output/measures/monthly_consult_LRTI.rds
        rds3: output/measures/monthly_consult_URTI.rds
        rds4: output/measures/monthly_consult_sinusitis.rds
        rds5: output/measures/monthly_consult_otmedia.rds
        rds6: output/measures/monthly_consult_ot_externa.rds
  
  describe_consultation_model_1:
    run: r:latest analysis/model/consult_model_1.R
    needs: [describe_consultation_model_process_2]
    outputs:
       moderately_sensitive:
        jpeg: output/consult_model1.jpeg
        rds: output/consult_model1.rds

  describe_consultation_model_2:
    run: r:latest analysis/model/consult_model_2.R
    needs: [describe_consultation_model_process_2]
    outputs:
       moderately_sensitive:
        jpeg: output/consult_model2.jpeg
        rds: output/consult_model2.rds
  
  # describe_consultation_model_3:
  #   run: r:latest analysis/model/consult_model_3.R
  #   needs: [describe_consultation_model_process_2]
  #   outputs:
  #      moderately_sensitive:
  #       jpeg: output/consult_model3.jpeg
  #       rds: output/consult_model3.rds

  check_consultation_model: #Poisson vs. NBR  
    run: r:latest -e 'rmarkdown::render("analysis/process/report/check_consultation_model.Rmd", output_dir = "output/report")'
    needs: [describe_consultation_model_process_2]
    outputs:
      moderately_sensitive:
        html: output/report/check_consultation_model.html

  consultation_model: # compare modeling1 &2
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model.rmd", output_dir = "output/report")'
    needs: [describe_consultation_model_process_1]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model.html


  consultation_model_ITS2: # compare modeling1 &2
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_ITS2.rmd", output_dir = "output/report")'
    needs: [describe_consultation_model_process_1]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model_ITS2.html

  consultation_model_ITS2_incident: 
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_ITS2_incident.Rmd", output_dir = "output/report")'
    needs: [describe_consultation_rate_all_incident_redacted]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model_ITS2_incident.html

  consultation_model_ITS2_prevalent: 
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_ITS2_prevalent.Rmd", output_dir = "output/report")'
    needs: [describe_consultation_rate_all_prevalent_redacted]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model_ITS2_prevalent.html

  consultation_model_ITS2_harmonic_month: #sine,cosine harmonic month
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_ITS2_harmonic_month.Rmd", output_dir = "output/report")'
    needs: [describe_consultation_model_process_1]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model_ITS2_harmonic_month.html

  consultation_model_ITS2_harmonic_month_incident: 
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_ITS2_harmonic_month_incident.Rmd", output_dir = "output/report")'
    needs: [describe_consultation_rate_all_incident_redacted]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model_ITS2_harmonic_month_incident.html

  consultation_model_ITS2_harmonic_month_prevalent: 
    run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_ITS2_harmonic_month_prevalent.Rmd", output_dir = "output/report")'
    needs: [describe_consultation_rate_all_prevalent_redacted]
    outputs:
      moderately_sensitive:
        html: output/report/consultation_model_ITS2_harmonic_month_prevalent.html

  # consultation_model_zero_truncated: # zero-truncated negative binomial
  #   run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_zero_truncated.rmd", output_dir = "output/report")'
  #   needs: [describe_consultation_model_process_1]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/consultation_model_zero_truncated.html


  # consultation_model_3: # model 3 for adjusting autocorrelation
  #   run: r:latest -e 'rmarkdown::render("analysis/model/consultation_model_3.rmd", output_dir = "output/report")'
  #   needs: [describe_consultation_model_process_1]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/consultation_model_3.html

  # check_consultation_model_urti: #  
  #   run: r:latest -e 'rmarkdown::render("analysis/process/report/check_consultation_model_urti.Rmd", output_dir = "output/report")'
  #   needs: [generate_measures_infection, describe_basic_record_process]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/check_consultation_model_urti.html

  # check_consultation_model_lrti: #  
  #   run: r:latest -e 'rmarkdown::render("analysis/process/report/check_consultation_model_lrti.Rmd", output_dir = "output/report")'
  #   needs: [generate_measures_infection, describe_basic_record_process]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/check_consultation_model_lrti.html

  # check_consultation_model_sinusitis: #  
  #   run: r:latest -e 'rmarkdown::render("analysis/process/report/check_consultation_model_sinusitis.Rmd", output_dir = "output/report")'
  #   needs: [generate_measures_infection, describe_basic_record_process]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/check_consultation_model_sinusitis.html

  # check_consultation_model_ot_externa: #  
  #   run: r:latest -e 'rmarkdown::render("analysis/process/report/check_consultation_model_ot_externa.Rmd", output_dir = "output/report")'
  #   needs: [generate_measures_infection, describe_basic_record_process]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/check_consultation_model_ot_externa.html

  # check_consultation_model_otmedia: #  
  #   run: r:latest -e 'rmarkdown::render("analysis/process/report/check_consultation_model_otmedia.Rmd", output_dir = "output/report")'
  #   needs: [generate_measures_infection, describe_basic_record_process]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/check_consultation_model_otmedia.html


  # # describe_infection_prescribed_percent:
  # #   run: r:latest analysis/plot/infection_prescibed_percent.R
  # #   needs: [generate_measures_infection]
  # #   outputs:
  # #      moderately_sensitive:
  # #       plot1: output/infection_ab_precent_p1.jpeg
  # #       plot2: output/infection_ab_precent_p2.jpeg
  # #       plot3: output/infection_ab_precent_i1.jpeg
  # #       plot4: output/infection_ab_precent_i2.jpeg
  # #       plot5: output/infection_ab_precent_all.jpeg
  # #       csv1: output/prescribed_infection_prevalent.csv
  # #       csv2: output/prescribed_infection_incident.csv

  # # describe_top10ABtypes_byInfection:
  # #   run: r:latest analysis/plot/abtypes_top10.R
  # #   needs: [generate_measures_infection]
  # #   outputs:
  # #      moderately_sensitive:
  # #       plot1: output/abtype_UTI.jpeg
  # #       plot2: output/abtype_URTI.jpeg
  # #       plot3: output/abtype_LRTI.jpeg
  # #       plot4: output/abtype_sinusitis.jpeg
  # #       plot5: output/abtype_ot_externa.jpeg
  # #       plot6: output/abtype_otmedia.jpeg
  # #       plot7: output/abtype_percent_UTI.jpeg
  # #       plot8: output/abtype_percent_URTI.jpeg
  # #       plot9: output/abtype_percent_LRTI.jpeg
  # #       plot10: output/abtype_percent_sinusitis.jpeg
  # #       plot11: output/abtype_percent_ot_externa.jpeg
  # #       plot12: output/abtype_percent_otmedia.jpeg
  # #       csv: output/abtype_top10_by_infection.csv
  
  # # describe_top10ABtypes_byInfection_line:
  # #   run: r:latest analysis/plot/abtypes_top10_line.R
  # #   needs: [generate_measures_infection]
  # #   outputs:
  # #      moderately_sensitive:
  # #       plot13: output/abtype_UTI_line.jpeg
  # #       plot14: output/abtype_URTI_line.jpeg
  # #       plot15: output/abtype_LRTI_line.jpeg
  # #       plot16: output/abtype_sinusitis_line.jpeg
  # #       plot17: output/abtype_ot_externa_line.jpeg
  # #       plot18: output/abtype_otmedia_line.jpeg
  # #       plot19: output/abtype_percent_UTI_line.jpeg
  # #       plot20: output/abtype_percent_URTI_line.jpeg
  # #       plot21: output/abtype_percent_LRTI_line.jpeg
  # #       plot22: output/abtype_percent_sinusitis_line.jpeg
  # #       plot23: output/abtype_percent_ot_externa_line.jpeg
  # #       plot24: output/abtype_percent_otmedia_line.jpeg
  # #       csv: output/abtype_top10_by_infection_line.csv
  
  # describe_top10ABtypes_total:
  #   run: r:latest analysis/plot/types_ab_prescriptions.R
  #   needs: [generate_study_population]
  #   outputs:
  #      moderately_sensitive:
  #       plot1: output/abtype_all_Rx.jpeg
  #       plot2: output/abtype_all_Rx_percent.jpeg

  describe_same_day_ab:
    run: r:latest analysis/plot/same_day_covid_ab.R
    needs: [generate_study_population_samedayab]
    outputs:
       moderately_sensitive:
        table1: output/sameday_positive_1_sgss.csv
        table2: output/sameday_positive_2_sgss.csv
        table3: output/sameday_ab_1_sgss.csv
        table4: output/sameday_ab_2_sgss.csv
        table5: output/sameday_positive_1_gp.csv
        table6: output/sameday_positive_2_gp.csv
        table7: output/sameday_ab_1_gp.csv
        table8: output/sameday_ab_2_gp.csv
        plot1: output/same_day_ab_prop_line_sgss.jpeg
        plot2: output/same_day_ab_prop_line_gp.jpeg

  # describe_same_day_ab_gp:
  #   run: r:latest analysis/plot/same_day_covid_ab_gp.R
  #   needs: [generate_measures]
  #   outputs:
  #      moderately_sensitive:
  #       plot: output/same_day_ab_prop_line_gp.jpeg

  generate_study_population_antibiotics: #  Antibiotics_recorded_01
    run: cohortextractor:latest generate_cohort --study-definition study_definition_antibiotics --index-date-range "2019-01-01 to today" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_antibiotics_*.csv.gz

### generate study cohort with the date of each prescriptions
  generate_study_population_antibiotics_tpye: 
    run: cohortextractor:latest generate_cohort --study-definition study_definition_antibiotics_type --index-date-range "2019-01-01 to today" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_antibiotics_type_*.csv.gz

### generate study cohort three months before 2019-01-01 to get the incident infection information
  generate_study_population_antibiotics_tpye_pre: 
    run: cohortextractor:latest generate_cohort --study-definition study_definition_antibiotics_type_pre --index-date-range "2018-10-01 to 2018-12-31" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_antibiotics_type_pre_*.csv.gz

  generate_study_population_antibiotics_covid: #  Ab for covid
    run: cohortextractor:latest generate_cohort --study-definition study_definition_antibiotics_covid --index-date-range "2019-01-01 to today" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_antibiotics_covid_*.csv.gz

  describe_ab_recoded_covid_process:
    run: r:latest analysis/process/ab_covid_transform.R
    needs: [generate_study_population_antibiotics_covid]
    outputs:
       highly_sensitive:
        rds1: output/measures/recorded_ab_covid_2019.rds
        rds2: output/measures/recorded_ab_covid_2020.rds
        rds3: output/measures/recorded_ab_covid_2021.rds
       # rds4: output/measures/recorded_ab_covid_2022.rds

# used describe_ab_recoded_broad_process instead
  # describe_ab_recoded_indication_process: #  Antibiotics_recorded_02: generate prescription-level dataset 
  #   run: r:latest analysis/process/ab_recorded_indication_transform.R
  #   needs: [generate_study_population_antibiotics_antibiotics]
  #   outputs:
  #      highly_sensitive:
  #       rds1: output/measures/recorded_ab_2019.rds
  #       rds2: output/measures/recorded_ab_2020.rds
  #       rds3: output/measures/recorded_ab_2021.rds
  #       rds4: output/measures/recorded_ab_2022.rds

  describe_ab_recoded_indication_plot_incident: 
    run: r:latest analysis/plot/ab_recorded_indication_plot_incident.R
    needs: [describe_ab_recoded_broad_process] # transfrom & define all variables
    outputs:
       moderately_sensitive:
        plot1: output/ab_recorded_incident_bar.jpeg
        plot2: output/ab_recorded_incident_line.jpeg
        csv: output/ab_recorded_incident.csv

  describe_ab_recoded_indication_plot_prevalent: 
    run: r:latest analysis/plot/ab_recorded_indication_plot_prevalent.R
    needs: [describe_ab_recoded_broad_process]
    outputs:
       moderately_sensitive:
        plot1: output/ab_recorded_prevalent_bar.jpeg
        plot2: output/ab_recorded_prevalent_line.jpeg
        csv: output/ab_recorded_prevalent.csv

  describe_ab_recoded_covid_plot_incident: # ab prescription on covid infection date
    run: r:latest analysis/plot/ab_recorded_covid_plot_incident.R
    needs: [describe_ab_recoded_covid_process] 
    outputs:
       moderately_sensitive:
        plot1: output/ab_recorded_covid_incident_bar.jpeg
        plot2: output/ab_recorded_covid_incident_line.jpeg
        csv: output/ab_recorded_covid_incident.csv

  describe_ab_recoded_covid_plot_prevalent: 
    run: r:latest analysis/plot/ab_recorded_covid_plot_prevalent.R
    needs: [describe_ab_recoded_covid_process]
    outputs:
       moderately_sensitive:
        plot1: output/ab_recorded_covid_prevalent_bar.jpeg
        plot2: output/ab_recorded_covid_prevalent_line.jpeg
        csv: output/ab_recorded_covid_prevalent.csv
  
  describe_ab_recoded_covid_all_plot_incident: # combind all indication and covid
    run: r:latest analysis/plot/ab_recorded_indic_plus_covid_plot_incident.R
    needs: [describe_ab_recoded_covid_plot_incident,describe_ab_recoded_indication_plot_incident] 
    outputs:
       moderately_sensitive:
        plot1: output/ab_recorded_covid_indication_incident_bar.jpeg
        plot2: output/ab_recorded_covid_indication_incident_line.jpeg
        csv: output/ab_recorded_covid_indication_incident.csv
  
  describe_ab_recoded_covid_all_plot_prevalent: 
    run: r:latest analysis/plot/ab_recorded_indic_plus_covid_plot_prevalent.R
    needs: [describe_ab_recoded_covid_plot_prevalent,describe_ab_recoded_indication_plot_prevalent] 
    outputs:
       moderately_sensitive:
        plot1: output/ab_recorded_covid_indication_prevalent_bar.jpeg
        plot2: output/ab_recorded_covid_indication_prevalent_line.jpeg
        csv: output/ab_recorded_covid_indication_prevalent.csv

  describe_ab_recoded_broad_process:
    run: r:latest analysis/process/broad_transform.R
    needs: [generate_study_population_antibiotics]
    outputs:
       highly_sensitive:
        rds1: output/measures/recorded_ab_broad_2019.rds
        rds2: output/measures/recorded_ab_broad_2020.rds
        rds3: output/measures/recorded_ab_broad_2021.rds
        rds4: output/measures/recorded_ab_broad_2022.rds

  describe_ab_type_process_1:
    run: r:latest analysis/process/ab_type_transform_1.R
    needs: [generate_study_population_antibiotics_tpye]
    outputs:
       highly_sensitive:
        rds1: output/measures/ab_type_2019.rds
        rds2: output/measures/ab_type_2020.rds

  describe_ab_type_process_2:
    run: r:latest analysis/process/ab_type_transform_2.R
    needs: [generate_study_population_antibiotics_tpye]
    outputs:
       highly_sensitive:
        rds1: output/measures/ab_type_2021.rds
        # rds2: output/measures/ab_type_2022.rds

  describe_ab_type_process_3:
    run: r:latest analysis/process/ab_type_transform_3.R
    needs: [generate_study_population_antibiotics_tpye]
    outputs:
       highly_sensitive:
        rds1: output/measures/ab_type_2022.rds

  describe_ab_type_process_pre:
    run: r:latest analysis/process/ab_type_transform_pre.R
    needs: [generate_study_population_antibiotics_tpye_pre]
    outputs:
       highly_sensitive:
        rds1: output/measures/ab_type_pre.rds

  describe_repeat_ab_table:
    run: r:latest analysis/tables/repeat_ab_table.R
    needs: [describe_ab_type_process_1,describe_ab_type_process_2,describe_ab_type_process_3,describe_ab_type_process_pre]
    outputs:
       moderately_sensitive:
        table1: output/blt_repeat_ab.csv
        table2: output/throat_ab.csv
        table3: output/throat_ab_type.csv

  describe_repeat_ab_table_2:
    run: r:latest analysis/tables/repeat_ab_table_2.R
    needs: [describe_ab_type_process_1,describe_ab_type_process_2,describe_ab_type_process_3,describe_ab_type_process_pre]
    outputs:
       moderately_sensitive:
        table1: output/asthma_ab.csv
        table2: output/asthma_ab_type.csv
        table3: output/cold_ab.csv
        table4: output/cold_ab_type.csv
        table5: output/cough_ab.csv
        table6: output/cough_ab_type.csv
        table7: output/copd_ab.csv
        table8: output/copd_ab_type.csv
        table9: output/pneumonia_ab.csv
        table10: output/pneumonia_ab_type.csv
        table11: output/renal_ab.csv
        table12: output/renal_ab_type.csv
        table13: output/sepsis_ab.csv
        table14: output/sepsis_ab_type.csv
        table15: output/uti_ab.csv
        table16: output/uti_ab_type.csv
        table17: output/lrti_ab.csv
        table18: output/lrti_ab_type.csv
        table19: output/urti_ab.csv
        table20: output/urti_ab_type.csv
        table21: output/sinusitis_ab.csv
        table22: output/sinusitis_ab_type.csv
        table23: output/otmedia_ab.csv
        table24: output/otmedia_ab_type.csv
        table25: output/ot_externa_ab.csv
        table26: output/ot_externa_ab_type.csv

  describe_ab_throat:
    run: r:latest analysis/plot/throat_ab.R
    needs: [describe_ab_type_process_1,describe_ab_type_process_2,describe_ab_type_process_3]
    outputs:
       moderately_sensitive:
        table: output/ab_throat.csv


  describe_broad_proportion:
    run: r:latest analysis/plot/broad_proportion.R
    needs: [describe_ab_recoded_broad_process]
    outputs:
       moderately_sensitive:
        plot: output/broad_proportions_line.jpeg
        table: output/broad_proportions.csv

  describe_basic_record_process:
    run: r:latest analysis/process/baseline_variables_transform.R
    needs: [generate_study_population]
    outputs:
       highly_sensitive:
        rds1: output/measures/basic_record_2019.rds
        rds2: output/measures/basic_record_2020.rds
        rds3: output/measures/basic_record_2021.rds
        rds4: output/measures/basic_record_2022.rds

  describe_check_broad_model_variable_2019:
    run: r:latest analysis/model/broad_variable_transform_2019.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        rds1: output/measures/model_variable_broad_2019_1.rds

  describe_check_broad_model_variable_2019_2:
    run: r:latest analysis/model/charlson_transform_2019.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        talbe1: output/model_varibale_table_charlson_2019.csv
        rds1: output/measures/model_variable_broad_2019_2.rds

  describe_check_broad_model_variable_2020:
    run: r:latest analysis/model/broad_variable_transform_2020.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        rds1: output/measures/model_variable_broad_2020_1.rds

  describe_check_broad_model_variable_2020_2:
    run: r:latest analysis/model/charlson_transform_2020.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        talbe1: output/model_varibale_table_charlson_2020.csv
        rds1: output/measures/model_variable_broad_2020_2.rds

  describe_check_broad_model_variable_2021:
    run: r:latest analysis/model/broad_variable_transform_2021.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        rds1: output/measures/model_variable_broad_2021_1.rds

  describe_check_broad_model_variable_2021_2:
    run: r:latest analysis/model/charlson_transform_2021.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        talbe1: output/model_varibale_table_charlson_2021.csv
        rds1: output/measures/model_variable_broad_2021_2.rds

  describe_check_broad_model_variable_2022:
    run: r:latest analysis/model/broad_variable_transform_2022.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        rds1: output/measures/model_variable_broad_2022_1.rds

  describe_check_broad_model_variable_2022_2:
    run: r:latest analysis/model/charlson_transform_2022.R
    needs: [describe_basic_record_process]
    outputs:
       highly_sensitive:
        talbe1: output/model_varibale_table_charlson_2022.csv
        rds1: output/measures/model_variable_broad_2022_2.rds

  describe_broad_model_2019:   
    run: r:latest -e 'rmarkdown::render("analysis/model/broad_model_2019.Rmd", output_dir = "output/report")'
    needs: [describe_check_broad_model_variable_2019, describe_check_broad_model_variable_2019_2, describe_ab_recoded_broad_process]
    outputs:
      moderately_sensitive:
        html: output/report/broad_model_2019.html

  describe_broad_model_covid:   
    run: r:latest -e 'rmarkdown::render("analysis/model/broad_model_covid.Rmd", output_dir = "output/report")'
    needs: [describe_check_broad_model_variable_2020, describe_check_broad_model_variable_2020_2,
    describe_check_broad_model_variable_2021, describe_check_broad_model_variable_2021_2,
    describe_check_broad_model_variable_2022, describe_check_broad_model_variable_2022_2,
    describe_ab_recoded_broad_process]
    outputs:
      moderately_sensitive:
        html: output/report/broad_model_covid.html

  # describe_descriptive_ab_broad:   
  #   run: r:latest -e 'rmarkdown::render("analysis/model/descriptive_ab_broad.Rmd", output_dir = "output/report")'
  #   needs: [generate_measures]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/descriptive_ab_broad.html

  # describe_baseline_tb:   
  #   run: r:latest -e 'rmarkdown::render("analysis/model/baseline_table_pat_one.Rmd", output_dir = "output/report")'
  #   needs: [describe_check_broad_model_variable_2019, describe_check_broad_model_variable_2019_2,
  #   describe_check_broad_model_variable_2020, describe_check_broad_model_variable_2020_2,
  #   describe_check_broad_model_variable_2021, describe_check_broad_model_variable_2021_2,
  #   describe_check_broad_model_variable_2022, describe_check_broad_model_variable_2022_2]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/baseline_table_pat_one.html
  
  # describe_baseline_tb_2019:   
  #   run: r:latest -e 'rmarkdown::render("analysis/model/baseline_table_pat_one_2019.Rmd", output_dir = "output/report")'
  #   needs: [describe_check_broad_model_variable_2019, describe_check_broad_model_variable_2019_2]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/baseline_table_pat_one_2019.html

  # describe_baseline_tb_2020:   
  #   run: r:latest -e 'rmarkdown::render("analysis/model/baseline_table_pat_one_2020.Rmd", output_dir = "output/report")'
  #   needs: [describe_check_broad_model_variable_2020, describe_check_broad_model_variable_2020_2]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/baseline_table_pat_one_2020.html

  # describe_baseline_tb_2021:   
  #   run: r:latest -e 'rmarkdown::render("analysis/model/baseline_table_pat_one_2021.Rmd", output_dir = "output/report")'
  #   needs: [describe_check_broad_model_variable_2021, describe_check_broad_model_variable_2021_2]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/baseline_table_pat_one_2021.html

  # describe_baseline_tb_2022:   
  #   run: r:latest -e 'rmarkdown::render("analysis/model/baseline_table_pat_one_2022.Rmd", output_dir = "output/report")'
  #   needs: [describe_check_broad_model_variable_2022, describe_check_broad_model_variable_2022_2]
  #   outputs:
  #     moderately_sensitive:
  #       html: output/report/baseline_table_pat_one_2022.html


  # describe_ab_recoded_indication_process_plot: #  Antibiotics_recorded_02: only indication/row
  #   run: r:latest analysis/process/ab_recorded_indication_transform_plot.R
  #   needs: [generate_study_population_antibiotics]
  #   outputs:
  #      highly_sensitive:
  #       rds1: output/measures/recorded_ab_indication_2019.rds
  #       rds2: output/measures/recorded_ab_indication_2020.rds
  #       rds3: output/measures/recorded_ab_indication_2021.rds
  #       rds4: output/measures/recorded_ab_indication_2022.rds

  # describe_ab_recoded_indication_plot: 
  #   run: r:latest analysis/plot/ab_recorded_indication_plot.R
  #   needs: [describe_ab_recoded_indication_process_plot]
  #   outputs:
  #      highly_sensitive:
  #       plot1: output/ab_recorded_indication_bar.jpeg
  #       plot2: output/ab_recorded_indication_line.jpeg
  #       csv: output/ab_recorded_indication.csv

  generate_study_population_infection_abtype: # for ab types plot
    run: cohortextractor:latest generate_cohort --study-definition study_definition_infection_abtype --index-date-range "2019-01-01 to today by month" --skip-existing --output-dir=output/measures --output-format=csv.gz
    outputs:
      highly_sensitive:
        cohort: output/measures/input_infection_abtype_*.csv.gz
  
  describe_infection_abtype_process: #  infection/row
    run: r:latest analysis/process/infection_abtype_transform.R
    needs: [generate_study_population_infection_abtype]
    outputs:
       highly_sensitive:
        rds1: output/measures/abtype_uti.rds
        rds2: output/measures/abtype_lrti.rds
        rds3: output/measures/abtype_urti.rds
        rds4: output/measures/abtype_sinusitis.rds
        rds5: output/measures/abtype_ot_externa.rds
        rds6: output/measures/abtype_otmedia.rds

  describe_infection_abtype_plot: #  incident+prevalent
    run: r:latest analysis/plot/infection_abtype.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/abtype_uti.jpeg
        plot2: output/abtype_lrti.jpeg
        plot3: output/abtype_urti.jpeg
        plot4: output/abtype_sinusitis.jpeg
        plot5: output/abtype_ot_externa.jpeg
        plot6: output/abtype_otmedia.jpeg
        csv1: output/abtype_uti.csv
        csv2: output/abtype_lrti.csv
        csv3: output/abtype_urti.csv
        csv4: output/abtype_sinusitis.csv
        csv5: output/abtype_ot_externa.csv
        csv6: output/abtype_otmedia.csv
       
  describe_infection_abtype_plot_redacted: #  incident+prevalent
    run: r:latest analysis/redaction/infection_abtype.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/redacted/abtype_uti.jpeg
        plot2: output/redacted/abtype_lrti.jpeg
        plot3: output/redacted/abtype_urti.jpeg
        plot4: output/redacted/abtype_sinusitis.jpeg
        plot5: output/redacted/abtype_ot_externa.jpeg
        plot6: output/redacted/abtype_otmedia.jpeg
        csv1: output/redacted/abtype_uti_check.csv
        csv2: output/redacted/abtype_lrti_check.csv
        csv3: output/redacted/abtype_urti_check.csv
        csv4: output/redacted/abtype_sinusitis_check.csv
        csv5: output/redacted/abtype_ot_externa_check.csv
        csv6: output/redacted/abtype_otmedia_check.csv
        csv7: output/redacted/abtype_uti.csv
        csv8: output/redacted/abtype_lrti.csv
        csv9: output/redacted/abtype_urti.csv
        csv10: output/redacted/abtype_sinusitis.csv
        csv11: output/redacted/abtype_ot_externa.csv
        csv12: output/redacted/abtype_otmedia.csv

  describe_infection_abtype_plot_count: #  output raw counts
    run: r:latest analysis/redaction/infection_abtype_counts.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/redacted/count_abtype_uti.jpeg
        plot2: output/redacted/count_abtype_lrti.jpeg
        plot3: output/redacted/count_abtype_urti.jpeg
        plot4: output/redacted/count_abtype_sinusitis.jpeg
        plot5: output/redacted/count_abtype_ot_externa.jpeg
        plot6: output/redacted/count_abtype_otmedia.jpeg
        csv1: output/redacted/count_abtype_uti_check.csv
        csv2: output/redacted/count_abtype_lrti_check.csv
        csv3: output/redacted/count_abtype_urti_check.csv
        csv4: output/redacted/count_abtype_sinusitis_check.csv
        csv5: output/redacted/count_abtype_ot_externa_check.csv
        csv6: output/redacted/count_abtype_otmedia_check.csv
        csv7: output/redacted/count_abtype_uti.csv
        csv8: output/redacted/count_abtype_lrti.csv
        csv9: output/redacted/count_abtype_urti.csv
        csv10: output/redacted/count_abtype_sinusitis.csv
        csv11: output/redacted/count_abtype_ot_externa.csv
        csv12: output/redacted/count_abtype_otmedia.csv

  describe_infection_noAB_plot: #  percentage
    run: r:latest analysis/redaction/infection_v2_noAB.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/redacted_v2/noAB_uti.jpeg
        plot2: output/redacted_v2/noAB_lrti.jpeg
        plot3: output/redacted_v2/noAB_urti.jpeg
        plot4: output/redacted_v2/noAB_sinusitis.jpeg
        plot5: output/redacted_v2/noAB_ot_externa.jpeg
        plot6: output/redacted_v2/noAB_otmedia.jpeg
        csv1: output/redacted_v2/noAB_uti_check.csv
        csv2: output/redacted_v2/noAB_lrti_check.csv
        csv3: output/redacted_v2/noAB_urti_check.csv
        csv4: output/redacted_v2/noAB_sinusitis_check.csv
        csv5: output/redacted_v2/noAB_ot_externa_check.csv
        csv6: output/redacted_v2/noAB_otmedia_check.csv
        csv7: output/redacted_v2/noAB.csv

  describe_infection_AB_plot: #  percentage
    run: r:latest analysis/redaction/infection_v2_AB.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/redacted_v2/AB_uti.jpeg
        plot2: output/redacted_v2/AB_lrti.jpeg
        plot3: output/redacted_v2/AB_urti.jpeg
        plot4: output/redacted_v2/AB_sinusitis.jpeg
        plot5: output/redacted_v2/AB_ot_externa.jpeg
        plot6: output/redacted_v2/AB_otmedia.jpeg
        csv1: output/redacted_v2/AB_uti_check.csv
        csv2: output/redacted_v2/AB_lrti_check.csv
        csv3: output/redacted_v2/AB_urti_check.csv
        csv4: output/redacted_v2/AB_sinusitis_check.csv
        csv5: output/redacted_v2/AB_ot_externa_check.csv
        csv6: output/redacted_v2/AB_otmedia_check.csv
        csv7: output/redacted_v2/AB.csv

  describe_infection_AB_plot_top3: #  percentage
    run: r:latest analysis/redaction/infection_v2_AB_top3.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/redacted_v2/AB_uti_top3.jpeg
        plot2: output/redacted_v2/AB_lrti_top3.jpeg
        plot3: output/redacted_v2/AB_urti_top3.jpeg
        plot4: output/redacted_v2/AB_sinusitis_top3.jpeg
        plot5: output/redacted_v2/AB_ot_externa_top3.jpeg
        plot6: output/redacted_v2/AB_otmedia_top3.jpeg
        csv1: output/redacted_v2/AB_uti_check_top3.csv
        csv2: output/redacted_v2/AB_lrti_check_top3.csv
        csv3: output/redacted_v2/AB_urti_check_top3.csv
        csv4: output/redacted_v2/AB_sinusitis_check_top3.csv
        csv5: output/redacted_v2/AB_ot_externa_check_top3.csv
        csv6: output/redacted_v2/AB_otmedia_check_top3.csv
        csv7: output/redacted_v2/AB_top3.csv

  describe_infection_AB_plot_top5: #  percentage
    run: r:latest analysis/redaction/infection_v2_AB_top5.R
    needs: [describe_infection_abtype_process]
    outputs:
       moderately_sensitive:
        plot1: output/redacted_v2/AB_uti_top5.jpeg
        plot2: output/redacted_v2/AB_lrti_top5.jpeg
        plot3: output/redacted_v2/AB_urti_top5.jpeg
        plot4: output/redacted_v2/AB_sinusitis_top5.jpeg
        plot5: output/redacted_v2/AB_ot_externa_top5.jpeg
        plot6: output/redacted_v2/AB_otmedia_top5.jpeg
        csv1: output/redacted_v2/AB_uti_check_top5.csv
        csv2: output/redacted_v2/AB_lrti_check_top5.csv
        csv3: output/redacted_v2/AB_urti_check_top5.csv
        csv4: output/redacted_v2/AB_sinusitis_check_top5.csv
        csv5: output/redacted_v2/AB_ot_externa_check_top5.csv
        csv6: output/redacted_v2/AB_otmedia_check_top5.csv
        csv7: output/redacted_v2/AB_top5.csv

  describe_broad_proportion_measure:   
    run: r:latest -e 'rmarkdown::render("analysis/model/descriptive_ab_broad_2.Rmd", output_dir = "output/report")'
    needs: [generate_measures]
    outputs:
      moderately_sensitive:
        html: output/report/descriptive_ab_broad_2.html

  describe_broad_type_analysis:   
    run: r:latest -e 'rmarkdown::render("analysis/model/broad_type.Rmd", output_dir = "output/report")'
    needs: [generate_measures]
    outputs:
      moderately_sensitive:
        html: output/report/broad_type.html

  describe_broad_percentage_op:
    run: r:latest analysis/plot/broad_percentage_op.R
    needs: [generate_measures_broad]
    outputs:
       moderately_sensitive:
        plot1: output/broad_percentage_op.jpeg



  # describe_broad_proportion_measure:
  #   run: r:latest analysis/plot/broad_proportion_measure.R
  #   needs: [generate_measures]
  #   outputs:
  #      moderately_sensitive:
  #       plot1: output/broad_proportions_overall.jpeg
  #       plot2: output/broad_proportions_practice.jpeg
