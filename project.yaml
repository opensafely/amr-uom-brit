version: '3.0'

expectations:
  population_size: 30000

actions:
### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ### ###
### study cohort ###

  generate_study_population_period_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1
    outputs:
      highly_sensitive:
        cohort: output/input_period_1.csv

  period_1_process:
    run: r:latest analysis/period_1_process.R
    needs: [generate_study_population_period_1]
    outputs:
      highly_sensitive: 
        csv1: output/period_1a.csv
        csv2: output/period_1_*.csv

  generate_study_population_period_1b:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_period_1b
    needs: [period_1_process]
    outputs:
      highly_sensitive:
        cohort: output/input_period_1b.csv

  period_1b_quickcheck:
    run: r:latest analysis/period_1b_quickcheck.R
    needs: [generate_study_population_period_1b]
    outputs:
      highly_sensitive: 
        csv1: output/period_1b_quickcheck.csv