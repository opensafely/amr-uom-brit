---
title: "Random Forest"
---

```{r setup, include=FALSE}
#library(knitr)
library(dplyr)
#library(skimr)
library('tidyverse')
#library("ggplot2")
#library(caret)
knitr::opts_chunk$set(echo = TRUE)
options(knitr.table.format="html")

```

# import dataset
```{r }
#train_Y <- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/train_Y.rds")
train_Y <- read_rds(here::here("output","train_Y.rds"))
train_Y=as.factor(train_Y)
#train_X <- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/train_X.rds")
train_X <- read_rds(here::here("output","train_X.rds"))

#valid_Y <- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/valid_Y.rds")
valid_Y <- read_rds(here::here("output","valid_Y.rds"))
valid_Y=as.factor(valid_Y)
#valid_X <- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/valid_X.rds")
valid_X <- read_rds(here::here("output","valid_X .rds"))

#df=sample_n(df,5000)
table(df$case)

n=nrow(df)
```

train model
```{r}
library(pROC)
library(randomForest)


result = expand.grid(
 # ntree=c(1000,1500),
#  sampsize = c(round(n*0.6), round(n*0.8), round(n*0.9)),
#  nodesize = c(50, 100, 200),
  mtry=1:sqrt(ncol(df)-1),
  valid_auc = NA)
               

for (i in 1:nrow(result)) {
  
  rf.model <- randomForest(formula = train_Y ~ ., data = train_X, 
                           replace = FALSE,
                           ntree = 5000,
                           sampsize = round(n*0.8),
                           nodesize =  10,
                           mtry = result[i,'mtry']
                           )
  
  pred.y <- predict(rf.model, valid_X, type = 'prob')[,2]
  roc_valid <- roc(valid_Y ~ pred.y)
  
  result[i,'valid_auc'] <- roc_valid[['auc']]
  
  plot(roc_valid)
  print(roc_valid)
  print(roc_valid$sensitivities)
  print(roc_valid$specificities)
  print(rf.model)
}

result
```

