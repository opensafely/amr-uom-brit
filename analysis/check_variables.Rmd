---
title: "conditional logistic regression"
---

```{r setup, include=FALSE}
#library(knitr)
library(dplyr)
#library(skimr)
library('tidyverse')
library("survival")
library(car)
library(pROC)
library(ggplot2)
library(viridis)
```

# import dataset
```{r }
#df<- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/train_X.rds")
df <- read_rds(here::here("output","train_X.rds"))

df1=df
df1$set=1

rm(df)

df <- read_rds(here::here("output","valid_X.rds"))

df2=df
df2$set=2
rm(df)

df=rbind(df1,df2)

#abtype=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/abtype.rds")
abtype <- read_rds(here::here("output","abtype.rds"))

col=c("case",'total_ab',"ab_types","exposure_period" ,"recent_ab_days", "broad_prop" ,"interval_med" , "interval_CV","length_CV","length_mean",abtype,"AB_6wk")

df=df%>% select(col)
rm(df1,df2)
#pred_col=c("patient_id","patient_index_date", "case","total_ab", "ab_prescriptions","ab_types","prescribe_times","exposure_period","recent_ab_days", "broad_prop" ,"broad_ab_prescriptions","interval_mean","interval_sd","interval_CV","length_mean", "length_sd", "length_CV","prescribe_time_0","prescribe_time_1","prescribe_time_2","prescribe_time_3",col,"AB_1_type","AB_6wk_type" ,"interval_med" ,"length_med" ,"ab_6w_binary" , "AB_6wk")
table(df$case)
str(df)

df$case=as.factor(df$case)
```

case
```{r}
sum(df$case==1)
summary(df[df$case==1,])
```
control
```{r}
sum(df$case==0)
summary(df[df$case==0,])
```

total ab
```{r}

for (i in 2:90) {

print(paste0(col[i]))
  
print(
  ggplot(df, aes(x=case, y=df[,col[i]])) + 
    geom_boxplot()
)
print(
ggplot(df,aes(x=case, y=df[,col[i]])) +
    geom_violin() +
    scale_fill_viridis(discrete = TRUE, alpha=0.6, option="A") 
)
  
}
```
