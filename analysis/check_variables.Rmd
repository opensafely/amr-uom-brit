---
title: "conditional logistic regression"
---

```{r setup, include=FALSE}
#library(knitr)
library(dplyr)
#library(skimr)
library('tidyverse')
library(car)
library(ggplot2)
library("corrplot")
```

# import dataset
```{r }
#df<- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/train_X.rds")
df <- read_rds(here::here("output","train_X.rds"))

df1=df
df1$set=1

rm(df)

df <- read_rds(here::here("output","valid_X.rds"))

df2=df
df2$set=2
rm(df)

df=rbind(df1,df2)

#abtype=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/abtype.rds")
abtype <- read_rds(here::here("output","abtype.rds"))

col=c("patient_id","patient_index_date", "case","total_ab", "ab_prescriptions","ab_types","prescribe_times","exposure_period","recent_ab_days", "broad_prop" ,"broad_ab_prescriptions","interval_mean","interval_sd","interval_CV","length_mean", "length_sd","length_CV","prescribe_time_0","prescribe_time_1","prescribe_time_2","prescribe_time_3","AB_1_type","AB_6wk_type" ,"interval_med" ,"length_med" ,"ab_6w_binary" , "AB_6wk",abtype)

numeric=c("total_ab","ab_prescriptions","ab_types","prescribe_times",
         "exposure_period","recent_ab_days", 
         "broad_prop","broad_ab_prescriptions",
         "interval_mean","interval_med" ,"interval_sd","interval_CV",
         "length_mean","length_med", "length_sd","length_CV","AB_6wk")

factor=c("prescribe_time_0","prescribe_time_1","prescribe_time_2","prescribe_time_3",
        "AB_1_type","AB_6wk_type","ab_6w_binary")

df=df%>% select(col)
rm(df1,df2)
#pred_col=c("patient_id","patient_index_date", "case","total_ab", "ab_prescriptions","ab_types","prescribe_times","exposure_period","recent_ab_days", "broad_prop" ,"broad_ab_prescriptions","interval_mean","interval_sd","interval_CV","length_mean", "length_sd", "length_CV","prescribe_time_0","prescribe_time_1","prescribe_time_2","prescribe_time_3",col,"AB_1_type","AB_6wk_type" ,"interval_med" ,"length_med" ,"ab_6w_binary" , "AB_6wk")
table(df$case)
str(df)

df$case=as.factor(df$case)
```


```{r}
corrplot(cor(df[,numeric]), method = "number",number.cex = 0.5)
```

```{r}
for (i in 1:length(factor)) {
print(factor[i])  
print(table(df$case, df[,factor[1]]))
print(prop.table(table(df$case, df[,factor[i]])))
}

```

