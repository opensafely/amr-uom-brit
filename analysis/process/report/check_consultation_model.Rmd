---
title: "Consultation counuts check"
---

#### materials:
##### Negative binomial regression
###### tutorial. https://stats.oarc.ucla.edu/r/dae/negative-binomial-regression/ 
#### Poisson vs. Negative Binomial
###### https://stats.oarc.ucla.edu/r/dae/negative-binomial-regression/  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/workspace')
```

## Methods

Interrupted time-series analyses (ITA) were used to compare the discrepancy of consultation rate before and during pandemic.

Covid-19 Pre-pandemic period : January to December, 2019

Covid-19 Pandemic period: April 2020 to December 2021 (exclusion: Jan.-Mar.,2020) 

Assessment period was done by every month to acquire the counts of infection consultations and population list size. 

```{r message=FALSE, include=FALSE}
library("ggplot2")
library("data.table")
library("dplyr")
library("tidyverse")
library("MASS")
#library("gtsummary")
```


```{r include=FALSE}
### Import data
#df1=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/measures/monthly_consult_UTI.rds")
#df2=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/measures/monthly_consult_LRTI.rds")
#df3=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/measures/monthly_consult_URTI.rds")
#df4=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/measures/monthly_consult_sinusitis.rds")
#df5=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/measures/monthly_consult_otmedia.rds")
#df6=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/measures/monthly_consult_ot_externa.rds")
df1=read_rds(here::here("output","measures","monthly_consult_UTI.rds"))
df2=read_rds(here::here("output","measures","monthly_consult_LRTI.rds"))
df3=read_rds(here::here("output","measures","monthly_consult_URTI.rds"))
df4=read_rds(here::here("output","measures","monthly_consult_sinusitis.rds"))
df5=read_rds(here::here("output","measures","monthly_consult_otmedia.rds"))
df6=read_rds(here::here("output","measures","monthly_consult_ot_externa.rds"))

df1$rate=df1$counts/df1$population*1000
df2$rate=df2$counts/df2$population*1000
df3$rate=df3$counts/df3$population*1000
df4$rate=df4$counts/df4$population*1000
df5$rate=df5$counts/df5$population*1000
df6$rate=df6$counts/df6$population*1000

```




## infection consultations rate 

#### UTI
```{r echo=FALSE}
ggplot(df1, aes(x=date, color=covid))+
  geom_line(aes(y=rate))+
  annotate(geom = "rect", xmin = as.Date("2020-01-01"),xmax = as.Date("2020-04-01"),ymin = -Inf, ymax = Inf,fill="grey90")

```

#### LRTI
```{r echo=FALSE}
ggplot(df2, aes(x=date,color=covid))+
  geom_line(aes(y=rate))+
  annotate(geom = "rect", xmin = as.Date("2020-01-01"),xmax = as.Date("2020-04-01"),ymin = -Inf, ymax = Inf,fill="grey90")

```

#### URTI
```{r echo=FALSE}
ggplot(df3, aes(x=date,color=covid))+
  geom_line(aes(y=rate))+
  annotate(geom = "rect", xmin = as.Date("2020-01-01"),xmax = as.Date("2020-04-01"),ymin = -Inf, ymax = Inf,fill="grey90")

```

#### Sinusitis
```{r echo=FALSE}
ggplot(df4, aes(x=date,color=covid))+
  geom_line(aes(y=rate))+
  annotate(geom = "rect", xmin = as.Date("2020-01-01"),xmax = as.Date("2020-04-01"),ymin = -Inf, ymax = Inf,fill="grey90")

```

#### Otitis media
```{r echo=FALSE}
ggplot(df5, aes(x=date,color=covid))+
  geom_line(aes(y=rate))+
  annotate(geom = "rect", xmin = as.Date("2020-01-01"),xmax = as.Date("2020-04-01"),ymin = -Inf, ymax = Inf,fill="grey90")

```

####  Otitis externa
```{r echo=FALSE}
ggplot(df6,aes(x=date,color=covid))+
  geom_line(aes(y=rate))+
  annotate(geom = "rect", xmin = as.Date("2020-01-01"),xmax = as.Date("2020-04-01"),ymin = -Inf, ymax = Inf,fill="grey90")

```


## Mean & variance
```{r}
means=c(mean(df1$counts),mean(df2$counts),mean(df3$counts),mean(df4$counts),mean(df5$counts),mean(df6$counts))
vars=c(var(df1$counts),var(df2$counts),var(df3$counts),var(df4$counts),var(df5$counts),var(df6$counts))
df=data.frame(rbind(means,vars))
names(df)[1]<-"UTI"
names(df)[2]<-"LRTI"
names(df)[3]<-"URTI"
names(df)[4]<-"Sinusitis"
names(df)[5]<-"Otitis media"
names(df)[6]<-"Otitis externa"
df
```

## Distribution of infection consultations

### UTI
```{r}
ggplot(df1, aes(x=counts)) + 
  geom_histogram(aes(y=..density..)) +
   geom_density(alpha=.2, fill="#FF6666") 
```

### LRTI
```{r}
ggplot(df2, aes(x=counts)) + 
  geom_histogram(aes(y=..density..)) +
   geom_density(alpha=.2, fill="#FF6666") 
```

### URTI
```{r}
ggplot(df3, aes(x=counts)) + 
  geom_histogram(aes(y=..density..)) +
   geom_density(alpha=.2, fill="#FF6666") 
```

### Sinusitis
```{r}
ggplot(df4, aes(x=counts)) + 
  geom_histogram(aes(y=..density..)) +
   geom_density(alpha=.2, fill="#FF6666") 
```

### Otitis media
```{r}
ggplot(df5, aes(x=counts)) + 
  geom_histogram(aes(y=..density..)) +
   geom_density(alpha=.2, fill="#FF6666") 
```

### Otitis externa
```{r}
ggplot(df6, aes(x=counts)) + 
  geom_histogram(aes(y=..density..)) +
   geom_density(alpha=.2, fill="#FF6666") 
```

