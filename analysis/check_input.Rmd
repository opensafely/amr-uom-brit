---
title: "Input Data Check"
output: 
  html_document:
   toc: true
   toc_depth: 2
   toc_float:
     collapsed: false
     smooth_scorll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r , include=FALSE}
require('tidyverse')
require("gtsummary")
require("ggplot2")
```

# cohort extractor

## study_population_covid_primary_care 
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","input_covid_primarycare.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)

dat$patient_index_date=ifelse(is.na(dat$patient_index_date),NA,1)

dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(dat)
```

## study_population_covid_SGSS
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","input_covid_SGSS.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)

dat$patient_index_date=ifelse(is.na(dat$patient_index_date),NA,1)

dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())

```



#  define case and control

#### case: covid infection with hospital admission
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","case_covid_hosp.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)

dat$patient_index_date=ifelse(is.na(dat$patient_index_date),NA,1)

dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```

## control_1: covid infection without any covid record later
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","control_covid_infection.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)

dat$patient_index_date=ifelse(is.na(dat$patient_index_date),NA,1)

dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


##  control_2: covid infection without any covid record later + any death later 
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","control_covid_infection_2.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)

dat$patient_index_date=ifelse(is.na(dat$patient_index_date),NA,1)

dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```

#  matching without replacement
### 1:6
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","matched_combined_infection_hosp_6.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```

### 1:4
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","matched_combined_infection_hosp_4.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```

### 1:2
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","matched_combined_infection_hosp_2.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


##  extracting variables
#### 1:6
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","input_outcome_2_6.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


### 1:4
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","input_outcome_2_4.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


### 1:2
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","input_outcome_2_2.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


## sorting variables
### 1:6
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","matched_outcome_6.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


### 1:4
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","matched_outcome_4.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```


### 1:2
###### patient_index_date range
```{r}
dat=read_csv(here::here("output","matched_outcome_2.csv"),
             col_types=cols_only(
               age=col_double(),
               sex=col_character(),
               patient_index_date=col_date()
             ))

range(dat$patient_index_date, na.rm=T)



dat %>%
  tbl_summary(
    statistic = list(
      all_continuous() ~ "{min}, {max}",
      all_categorical() ~ "{n} ({p}%)"))
rm(list=ls())
```



