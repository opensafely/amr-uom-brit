---
title: "AB in 3 years"
output: 
  html_document:
   toc: true
   toc_depth: 2
   toc_float:
     collapsed: false
     smooth_scorll: false
---

```{r setup, include=FALSE}
library('tidyverse')
library("ggplot2")
library('dplyr')
library('lubridate')

knitr::opts_chunk$set(echo = TRUE)
options(knitr.table.format="html")
```


```{r}
#setwd(here::here("output"))
setwd("/Users/yayang/Documents/GitHub/amr-uom-brit/output")
df <- read_rds("abtype79.rds")
count(df)
```

```{r}
df1=df%>%filter(case==1)
df0=df%>%filter(case==0)
# random 1 control
df0=df%>% group_by(subclass)%>%sample_n(1)
df0=ungroup(df0)

df=rbind(df1,df0)
count(df1)
count(df0)
count(df)
```


```{r}
keep.var=c("Rx_Amoxicillin","Rx_Azithromycin","Rx_Cefalexin","Rx_Ciprofloxacin","Rx_Clarithromycin","Rx_Co_amoxiclav","Rx_Doxycycline","Rx_Flucloxacillin","Rx_Nitrofurantoin","Rx_Phenoxymethylpenicillin","Rx_Trimethoprim","case")

DF=df[colnames(df) %in% keep.var]

df1=DF%>% filter(case==1)

DF_case=vector()
for (i in 1:11){
   DF_case[i]=sum(df1[keep.var[i]])
  }
DF_case=data.frame(DF_case)

DF_case$AB=keep.var[1:11]
```

```{r}

df0=DF%>% filter(case==0)

DF_control=vector()
for (i in 1:11){
   DF_control[i]=sum(df0[keep.var[i]])
  }
DF_control=data.frame(DF_control)

DF_control$AB=keep.var[1:11]


```


```{r}
for (i in 1:11){

DF_ab=DF%>%filter(key==AB_name[i])

DF_ab$case=as.factor(DF_ab$case)
DF_ab$month=as.factor(DF_ab$month)

print(
ggplot(data=DF_ab, aes(x=month, y=value, fill=case)) +
  geom_col(position="dodge", stat="identity")
)
}
```

