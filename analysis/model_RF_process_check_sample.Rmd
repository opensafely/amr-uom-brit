---
title: "random sampling by subclass"
---

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(skimr)
library('tidyverse')

library("ggplot2")

library(caret)
knitr::opts_chunk$set(echo = TRUE)
options(knitr.table.format="html")
```


```{r eval=FALSE, include=FALSE}
#df <- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/matched_ab.rds")
df <- read_rds(here::here("output","matched_ab.rds"))
count(df)

df=df[!is.na(df$case),]
count(df)
table(df$case)

df_uniq= distinct(df)
count(df_uniq)
table(df_uniq$case)


```


```{r }
#DF <- read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/matched_outcome.rds")
DF<- read_rds(here::here("output","matched_outcome.rds"))
DF=DF%>% select("patient_id","patient_index_date","case","age","wave","sex","age_cat","region","subclass")
count(DF)
table(DF$case)


DF=DF[!is.na(DF$case),]
count(DF)
table(DF$case)


DF_uniq=DF%>% distinct(patient_id,patient_index_date, .keep_all=T)
count(DF_uniq)
table(DF_uniq$case)
# filter only 1 ID
#df=df %>% distinct(patient_id, .keep_all=T)
#data=merge(df,DF,by=c("patient_id","patient_index_date"), all.x = TRUE)

#df=data
#rm(DF,data)

#table(df$case)



DF_sub = DF%>% group_by(subclass,case) %>% sample_n(1)
DF_sub=DF_sub%>%ungroup(subclass,case)
count(DF_sub)
table(DF_sub$case)
```


```{r}
DF$case=as.factor(DF$case)
DF$sex=as.factor(DF$sex)

#boxplot(age ~ case, data = DF)
densityplot(~ wave, data = DF, groups = case)
densityplot(~ age, data = DF, groups = case)

tbl1=table(DF$sex,DF$case)
tbl2=table(DF$region,DF$case)

prop.table(tbl1, 2)
prop.table(tbl2, 2)

```


# distinct
```{r}
DF_uniq$case=as.factor(DF_uniq$case)
DF_uniq$sex=as.factor(DF_uniq$sex)

densityplot(~ wave, data = DF_uniq, groups = case)
densityplot(~ age, data = DF_uniq, groups = case)

tbl1=table(DF_uniq$sex,DF_uniq$case) 
tbl2=table(DF_uniq$region,DF_uniq$case)


prop.table(tbl1, 2)
prop.table(tbl2, 2)

```


# random selection
```{r}
DF_sub$case=as.factor(DF_sub$case)
DF_sub$sex=as.factor(DF_sub$sex)

densityplot(~ wave, data = DF_sub, groups = case)
densityplot(~ age, data = DF_sub, groups = case)

tbl1=table(DF_sub$sex,DF_sub$case) 
tbl2=table(DF_sub$region,DF_sub$case)

prop.table(tbl1, 2)
prop.table(tbl2, 2)
```

