---
title: "table 2_describe ab"
output: 
  html_document:
   toc: true
   toc_depth: 2
   toc_float:
     collapsed: false
     smooth_scorll: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r packages, include=FALSE}
require('tidyverse')
require("gtsummary")
```


# antibiotics by case/control

```{r}
#df1=read_rds("/Users/yayang/Documents/GitHub/amr-uom-brit/output/matched_outcome.rds")

df1 <- read_rds(here::here("output","matched_outcome.rds"))
df1=df1%>% select("case","total_ab","ab_prescriptions","broad_ab_prescriptions" ,"level", "lastABtime")
df1$total_ab=ifelse(df1$total_ab==0,NA,1)
df1$ab_prescriptions=ifelse(df1$ab_prescriptions==0,NA,1)
df1$broad_ab_prescriptions=ifelse(df1$broad_ab_prescriptions==0,NA,1)

df1$lastABtime=ifelse(is.na(df1$total_ab),NA,df1$lastABtime)

```

```{r}

#df0=df0%>%select("stp")

table1 <- 
  tbl_summary(
    df1,
    by = case, 
  #  statistic = list(all_continuous() ~ "{median} ({IQR})",
   #                  all_categorical() ~ "{n}  ({p}%)"),
    digits = all_continuous() ~ 2,
  ) %>%
  modify_header(label = "**Variable**") %>% # update the column header
  bold_labels() 

table1
```


# Antibiotics 
```{r}
df00=df1%>%select("case","total_ab" ,"level")%>%filter(case==0)

df01=df1%>%select("case","total_ab" ,"level")%>%filter(case==1)

```



## case
```{r}
# case
l1=rbind(summary(df01[df01$level==0,]$total_ab),
        summary(df01[df01$level==1,]$total_ab),
        summary(df01[df01$level==2,]$total_ab),
        summary(df01[df01$level==3,]$total_ab),
        summary(df01[df01$level==4,]$total_ab),
        summary(df01[df01$level==5,]$total_ab))
l1=data.frame(l1)

l1=l1%>%select("Median","X1st.Qu.", "X3rd.Qu.","Mean","Min.","Max.")

rownames(l1)<-c("level0","level1","level2","level3","level4","level5")
l1
```

## control
```{r}

# control
l0=rbind(summary(df00[df00$level==0,]$total_ab),
        summary(df00[df00$level==1,]$total_ab),
        summary(df00[df00$level==2,]$total_ab),
        summary(df00[df00$level==3,]$total_ab),
        summary(df00[df00$level==4,]$total_ab),
        summary(df00[df00$level==5,]$total_ab))

l0=data.frame(l0)

l0=l0%>%select("Median","X1st.Qu.", "X3rd.Qu.","Mean","Min.","Max.")

rownames(l0)<-c("level0","level1","level2","level3","level4","level5")


l0


```
