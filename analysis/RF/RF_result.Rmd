---
title: " Descriptive stat of RF classification: ab types"
---

```{r setup, include=FALSE}
library('tidyverse')
library("ggplot2")
library("plyr")
library('dplyr')
library('lubridate')
library('stringr')
library("data.table")
library("ggpubr")
library("finalfit")
```




# input data

# read table
```{r}
data=read_rds(here::here("output","all_ranger.rds"))
#data=data%>%filter("patient_id","patient_index_date","decile")
nrow(data)
data$decile=as.factor(data$decile)
data$patient_id=as.factor(data$patient_id)
data$patient_index_date=as.factor(data$patient_index_date)
nrow(data)

data=data%>% select(decile, patient_index_date, patient_id)

abtype=read_rds(here::here("output","abtype79.rds"))
nrow(abtype)
abtype$patient_id=as.factor(abtype$patient_id)
abtype$patient_index_date=as.factor(abtype$patient_index_date)
nrow(abtype)
abtype=abtype%>%distinct(patient_id,patient_index_date, .keep_all = TRUE)
nrow(abtype)

DF=merge(data,abtype, by=c("patient_id","patient_index_date"))
nrow(DF)

head(DF)
tail(DF)
```



# descriptive stat
## all data
```{r}

explanatory=c("Rx_Amikacin", "Rx_Amoxicillin", "Rx_Ampicillin", "Rx_Azithromycin", "Rx_Aztreonam", "Rx_Benzylpenicillin", "Rx_Cefaclor", "Rx_Cefadroxil", "Rx_Cefalexin", "Rx_Cefamandole", "Rx_Cefazolin", "Rx_Cefepime", "Rx_Cefixime", "Rx_Cefotaxime", "Rx_Cefoxitin", "Rx_Cefpirome", "Rx_Cefpodoxime", "Rx_Cefprozil", "Rx_Cefradine", "Rx_Ceftazidime", "Rx_Ceftriaxone", "Rx_Cefuroxime", "Rx_Chloramphenicol", "Rx_Cilastatin", "Rx_Ciprofloxacin", "Rx_Clarithromycin", "Rx_Clindamycin", "Rx_Co_amoxiclav", "Rx_Co_fluampicil", "Rx_Colistimethate", "Rx_Dalbavancin", "Rx_Dalfopristin", "Rx_Daptomycin", "Rx_Demeclocycline", "Rx_Doripenem", "Rx_Doxycycline", "Rx_Ertapenem", "Rx_Erythromycin", "Rx_Fidaxomicin", "Rx_Flucloxacillin", "Rx_Fosfomycin", "Rx_Fusidate", "Rx_Gentamicin", "Rx_Levofloxacin", "Rx_Linezolid", "Rx_Lymecycline", "Rx_Meropenem", "Rx_Methenamine", "Rx_Metronidazole", "Rx_Minocycline", "Rx_Moxifloxacin", "Rx_Nalidixic_acid", "Rx_Neomycin", "Rx_Netilmicin", "Rx_Nitazoxanid", "Rx_Nitrofurantoin", "Rx_Norfloxacin", "Rx_Ofloxacin", "Rx_Oxytetracycline", "Rx_Phenoxymethylpenicillin", "Rx_Piperacillin", "Rx_Pivmecillinam", "Rx_Pristinamycin", "Rx_Rifaximin", "Rx_Sulfadiazine", "Rx_Sulfamethoxazole", "Rx_Sulfapyridine", "Rx_Taurolidin", "Rx_Tedizolid", "Rx_Teicoplanin", "Rx_Telithromycin", "Rx_Temocillin", "Rx_Tetracycline", "Rx_Ticarcillin", "Rx_Tigecycline", "Rx_Tinidazole", "Rx_Tobramycin", "Rx_Trimethoprim", "Rx_Vancomycin")
dependent <- "decile"


DF=DF%>%mutate_at(explanatory, as.numeric)
DF=DF[,explanatory>0]

tbl=DF%>% summary_factorlist(dependent, explanatory, cont = "median")
tbl

```

```{r}
df=DF[,explanatory]

df=df%>%mutate_at(explanatory, as.numeric)

temp=data.frame()

for (i in 1:10) {
  df=DF%>%filter(decile==i)
  
 temp[i,]= colSums(df)
  
}
colnames(temp)= explanatory

temp
```


# distinct
```{r}
DF=DF%>%distinct(patient_id,patient_index_date, .keep_all = TRUE)
DF=DF%>%mutate_at(explanatory, as.numeric)

tbl=DF%>% summary_factorlist(dependent, explanatory, cont = "median")
tbl
```

```{r}
df=DF[,explanatory]
df=df%>%mutate_at(explanatory, as.numeric)

temp=data.frame()

for (i in 1:10) {
  df=DF%>%filter(decile==i)
  
 temp[i,]= colSums(df)
  
}
colnames(temp)= explanatory

temp
```