---
title: "top 5 antibiotics by infections"
output: 
  html_document:
   toc: true
   toc_depth: 2
   toc_float:
     collapsed: false
     smooth_scorll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
knitr::opts_knit$set(root.dir = '/workspace')
```

```{r include=FALSE}
library("tidyverse") 
library('dplyr')#conflict with plyr; load after plyr
library('lubridate')
library(scales)
#setwd(here::here("output", "measures"))
```

# UTI

```{r include=FALSE}
########### UTI
#df=read.csv("/Users/yayang/Documents/GitHub/amr-uom-brit/output/redacted_v2/AB_uti_check_top5.csv")
df=read.csv(here::here("output","redacted_v2","AB_uti_check_top5.csv"))
df$date=as.Date(df$date)

df$raw_count=df$count
df$raw_total=df$total

df$count=round(df$raw_count/5)*5
df=df%>%group_by(date,prevalent)%>%mutate(total=sum(count))


df.1=df%>%filter(prevalent==1)
df.0=df%>%filter(prevalent==0)
```


## incident
```{r echo=FALSE}

lineplot.0<- ggplot(df.0, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "UTI")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.0

```

## prevalent
```{r echo=FALSE}
### line graph
# prevalent
lineplot.1<- ggplot(df.1, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "UTI")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.1
```




# URTI

```{r include=FALSE}
########### UTI
#df=read.csv("/Users/yayang/Documents/GitHub/amr-uom-brit/output/redacted_v2/AB_uti_check_top5.csv")
df=read.csv(here::here("output","redacted_v2","AB_urti_check_top5.csv"))
df$date=as.Date(df$date)

df$raw_count=df$count
df$raw_total=df$total

df$count=round(df$raw_count/5)*5
df=df%>%group_by(date,prevalent)%>%mutate(total=sum(count))


df.1=df%>%filter(prevalent==1)
df.0=df%>%filter(prevalent==0)
```


## incident
```{r echo=FALSE}

lineplot.0<- ggplot(df.0, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "URTI")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.0

```

## prevalent
```{r echo=FALSE}
### line graph
# prevalent
lineplot.1<- ggplot(df.1, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "URTI")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.1
```




# LRTI

```{r include=FALSE}
########### UTI
#df=read.csv("/Users/yayang/Documents/GitHub/amr-uom-brit/output/redacted_v2/AB_uti_check_top5.csv")
df=read.csv(here::here("output","redacted_v2","AB_lrti_check_top5.csv"))
df$date=as.Date(df$date)

df$raw_count=df$count
df$raw_total=df$total

df$count=round(df$raw_count/5)*5
df=df%>%group_by(date,prevalent)%>%mutate(total=sum(count))


df.1=df%>%filter(prevalent==1)
df.0=df%>%filter(prevalent==0)
```


## incident
```{r echo=FALSE}

lineplot.0<- ggplot(df.0, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "LRTI")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.0

```

## prevalent
```{r echo=FALSE}
### line graph
# prevalent
lineplot.1<- ggplot(df.1, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "LRTI")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.1
```


# Sinusitis

```{r include=FALSE}
########### UTI
#df=read.csv("/Users/yayang/Documents/GitHub/amr-uom-brit/output/redacted_v2/AB_uti_check_top5.csv")
df=read.csv(here::here("output","redacted_v2","AB_sinusitis_check_top5.csv"))
df$date=as.Date(df$date)

df$raw_count=df$count
df$raw_total=df$total

df$count=round(df$raw_count/5)*5
df=df%>%group_by(date,prevalent)%>%mutate(total=sum(count))


df.1=df%>%filter(prevalent==1)
df.0=df%>%filter(prevalent==0)
```


## incident
```{r echo=FALSE}

lineplot.0<- ggplot(df.0, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "Sinusitis")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.0

```

## prevalent
```{r echo=FALSE}
### line graph
# prevalent
lineplot.1<- ggplot(df.1, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "Sinusitis")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.1
```


# Otitis media

```{r include=FALSE}
########### UTI
#df=read.csv("/Users/yayang/Documents/GitHub/amr-uom-brit/output/redacted_v2/AB_uti_check_top5.csv")
df=read.csv(here::here("output","redacted_v2","AB_otmedia_check_top5.csv"))
df$date=as.Date(df$date)

df$raw_count=df$count
df$raw_total=df$total

df$count=round(df$raw_count/5)*5
df=df%>%group_by(date,prevalent)%>%mutate(total=sum(count))


df.1=df%>%filter(prevalent==1)
df.0=df%>%filter(prevalent==0)
```


## incident
```{r echo=FALSE}

lineplot.0<- ggplot(df.0, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "Otitis media")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.0

```

## prevalent
```{r echo=FALSE}
### line graph
# prevalent
lineplot.1<- ggplot(df.1, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "Otitis media")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.1
```


# Otitis externa

```{r include=FALSE}
########### UTI
#df=read.csv("/Users/yayang/Documents/GitHub/amr-uom-brit/output/redacted_v2/AB_uti_check_top5.csv")
df=read.csv(here::here("output","redacted_v2","AB_ot_externa_check_top5.csv"))
df$date=as.Date(df$date)

df$raw_count=df$count
df$raw_total=df$total

df$count=round(df$raw_count/5)*5
df=df%>%group_by(date,prevalent)%>%mutate(total=sum(count))


df.1=df%>%filter(prevalent==1)
df.0=df%>%filter(prevalent==0)
```


## incident
```{r echo=FALSE}

lineplot.0<- ggplot(df.0, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "Otitis externa")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.0

```

## prevalent
```{r echo=FALSE}
### line graph
# prevalent
lineplot.1<- ggplot(df.1, aes(x=date, y=percentage, group=type,color=type))+
  annotate(geom = "rect", xmin = as.Date("2021-01-01"),xmax = as.Date("2021-04-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-11-01"),xmax = as.Date("2020-12-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  annotate(geom = "rect", xmin = as.Date("2020-03-01"),xmax = as.Date("2020-06-01"),ymin = -Inf, ymax = Inf,fill="grey80", alpha=0.5)+
  geom_line(aes(linetype=type))+
  geom_point(aes(shape=type))+
  theme(legend.position = "bottom",legend.title =element_blank())+
  scale_shape_manual(values = c(rep(1:6))) +
  scale_color_manual(values = c("coral2","darkred","goldenrod2","forestgreen","dodgerblue","black"))+
  labs(
    y = "" ,
    x="",
    title = "Otitis externa")+
  theme(axis.text.x=element_text(angle=60,hjust=1))+
  scale_x_date(date_labels = "%m-%Y", date_breaks = "3 month")+
  scale_y_continuous(labels = scales::percent)

lineplot.1
```








