---
title: "data flow patient number"

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
library('tidyverse')
library('dplyr')
library('lubridate')
```

### hospital admission
```{r echo=FALSE, message=FALSE, warning=FALSE}
# import data
df <- read_csv(here::here("output", "input_covid_admission.csv"))
#df=read_csv("input_covid_admission.csv")
df=df%>%filter(patient_index_date <= as.Date("2021-12-31"))
round(nrow(df)/5)*5
```

### hospital admission (remove NA)
```{r echo=FALSE, message=FALSE, warning=FALSE}
# filter cohort
df=df%>%filter( !is.na(patient_index_date)) # covid hospital case

round(nrow(df)/5)*5
```

## cohort: covid hospital admission (incident covid infeciton, so exclude recors outside 1 month)
```{r echo=FALSE, message=FALSE, warning=FALSE}
## CASE - covid hospital admission (incident covid infeciton, so exclude recors outside 1 month)
df=df%>%filter(
         is.na(SGSS_positive_test_date_before),
         is.na(primary_care_covid_date_before), 
         is.na(died_date_cpns_before),
         is.na(died_date_ons_covid_before))
round(nrow(df)/5)*5
```

## CASE - covid icu or covid death within 1 month
```{r echo=FALSE, message=FALSE, warning=FALSE}
# calendar month for matching
df$cal_YM=format(df$patient_index_date,"%Y-%m")

## CASE - covid icu or covid death within 1 month
df1=df%>%
  filter(icu_days>0|
           !is.na(died_date_ons_covid_after)|
           !is.na(died_date_cpns_after))

round(nrow(df1)/5)*5
```

## Control - covid hospital without any covid severe outcome within 1 month
```{r echo=FALSE, message=FALSE, warning=FALSE}
## Control - covid hospital without any covid severe outcome within 1 month
df01=df%>%
  filter(
    icu_days== 0 | is.na(icu_days),
    is.na(died_date_cpns_after),
    is.na(died_date_ons_covid_after))

round(nrow(df01)/5)*5

```

