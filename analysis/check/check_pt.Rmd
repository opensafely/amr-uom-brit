---
title: " patient selection flowchart"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE)
#library(knitr)
library(dplyr)
```

# hospital admission
```{r }
df <- read.csv(here::here("output","input_covid_admission.csv"))
N=nrow(df)
R1=c(round(N/5)*5,"hosp")
```


# primary care
```{r}
df1 <- read.csv(here::here("output","input_covid_primarycare.csv"))
N=nrow(df1)
round(N/5)*5
R2=c(round(N/5)*5,"GP")

```

# SGSS
```{r}
df2 <- read.csv(here::here("output","input_covid_SGSS.csv"))
N=nrow(df2)
round(N/5)*5
R3=c(round(N/5)*5,"SGSS")

```


## covid infection (merged primary+SGSS)
```{r}
df=rbind(df1,df2)


# keep earlist covid infection date
df=df%>%
  group_by(patient_id)%>%
  arrange(patient_id,patient_index_date)%>%
  distinct(patient_id, .keep_all = TRUE)


N=nrow(df)
round(N/5)*5
R4=c(round(N/5)*5,"infection(hosp+SGSS)")

```


# control
```{r}
df <- read.csv(here::here("output","control_covid_infection.csv"))
N=nrow(df)
round(N/5)*5
R5=c(round(N/5)*5,"control")

```

# case
```{r}
df <- read.csv(here::here("output","case_covid_hosp.csv"))
N=nrow(df)
round(N/5)*5
R6=c(round(N/5)*5,"case")

```


# matching (case vs. control)
```{r}
df=readRDS(here::here("output","matched_ab.rds"))
df0=df%>%filter(case==0)
N=nrow(df0)
round(N/5)*5
R7=c(round(N/5)*5,"matched.contr")

df1=df%>%filter(case==1)
N=nrow(df1)
round(N/5)*5
R8=c(round(N/5)*5,"matched.case")

```

```{r}
tbl=rbind(R1,R2,R3,R4,R5,R6,R7,R8)
write.csv(tbl,here::here("output","pt_no.csv"))
```

